

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CXL: Boot To Bash documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx_lesson.css" />
      <link rel="stylesheet" type="text/css" href="_static/term_role_formatting.css" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx_rtd_theme_ext_color_contrast.css" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js"></script>
      <script src="_static/doctools.js"></script>
      <script src="_static/sphinx_highlight.js"></script>
      <script src="_static/clipboard.min.js"></script>
      <script src="_static/copybutton.js"></script>
      <script src="_static/minipres.js"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="_static/togglebutton.js"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script data-domain="coderefinery.github.io" defer="defer" src="https://plausible.cs.aalto.fi/js/script.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            CXL: Boot To Bash
          </a>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#document-index">CXL on Linux: Boot To Bash</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Device Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-devices/device-types">Devices and Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-devices/uefi">UEFI Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Platform Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-platform/bios-and-efi">BIOS/EFI Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-platform/acpi">ACPI Tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-platform/example-configs">Example Platform Configurations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Linux Kernel Configuration:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-linux/overview">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-linux/early-boot">Linux Init (Early Boot)</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-linux/cxl-driver">CXL Driver Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-linux/dax-driver">DAX Driver Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-linux/memory-hotplug">Memory Hotplug</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Memory Allocation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-allocation/dax">DAX Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-allocation/page-allocator">The Page Allocator</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-allocation/reclaim">Reclaim</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-allocation/hugepages">Huge Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-allocation/tiering">Memory Tiering</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use Cases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-use-case/memory-expansion">Memory Expansion</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-use-case/dynamic-capacity">Dynamic Capacity</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-use-case/virtual-machines">Virtual Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-use-case/shared-memory">Shared Memory</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">CXL: Boot To Bash</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">CXL: Boot To Bash  documentation</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/gourryinverse/cxl-boot-to-bash/blob/main/doc/index" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cxl-on-linux-boot-to-bash">
<h1>CXL on Linux: Boot To Bash<a class="headerlink" href="#cxl-on-linux-boot-to-bash" title="Link to this heading"></a></h1>
<p>This documentation is intended as a companion to systems engineers (Platform, BIOS, EFI, OS, etc)
trying to enable CXL devices on Linux.</p>
<p>CXL device configuration requires platform (Hardware, BIOS, EFI), OS (early boot, core kernel,
driver), and user policy decisions that all impact each other.  This doc breaks up these
configurations into five main areas:</p>
<div class="toctree-wrapper compound">
</div>
<div class="toctree-wrapper compound">
<span id="document-devices/device-types"></span><section id="devices-and-protocols">
<h2>Devices and Protocols<a class="headerlink" href="#devices-and-protocols" title="Link to this heading"></a></h2>
<p>The type of CXL device (Memory, Accelerator, etc) dictates many configuration steps. This section
covers some basic background on device types and on-device resources used by the platform and OS
which impact configuration.</p>
<section id="protocols">
<h3>Protocols<a class="headerlink" href="#protocols" title="Link to this heading"></a></h3>
<p>There are three core protocols to CXL.  For the purpose of this documentation,
we will only discuss very high level definitions as the specific hardware
details are largely abstracted away from Linux.  See the CXL specification
for more details.</p>
<section id="cxl-io">
<h4>CXL.io<a class="headerlink" href="#cxl-io" title="Link to this heading"></a></h4>
<p>The basic interaction protocol, similar to PCIe configuration mechanisms.
Typically used for initialization, configuration, and I/O access for anything
other than memory (CXL.mem) or cache (CXL.cache) operations.</p>
<p>The Linux CXL driver exposes access to .io functionalty via the various sysfs
interfaces and /dev/cxl/ devices (which exposes direct access to device
mailboxes).</p>
</section>
<section id="cxl-cache">
<h4>CXL.cache<a class="headerlink" href="#cxl-cache" title="Link to this heading"></a></h4>
<p>The mechanism by which a device may coherently access and cache host memory.</p>
<p>Largely transparent to Linux once configured.</p>
</section>
<section id="cxl-mem">
<h4>CXL.mem<a class="headerlink" href="#cxl-mem" title="Link to this heading"></a></h4>
<p>The mechanism by which the CPU may coherently access and cache device memory.</p>
<p>Largely transparent to Linux once configured.</p>
</section>
</section>
<section id="device-types">
<h3>Device Types<a class="headerlink" href="#device-types" title="Link to this heading"></a></h3>
<section id="type-1">
<h4>Type-1<a class="headerlink" href="#type-1" title="Link to this heading"></a></h4>
<p>A Type-1 CXL device:</p>
<ul class="simple">
<li><p>Supports cxl.io and cxl.cache protocols</p></li>
<li><p>Implements a fully coherent cache</p></li>
<li><p>Allow Device-to-Host coherence and Host-to-Device snoops.</p></li>
<li><p>Does NOT have host-managed device memory (HDM)</p></li>
</ul>
<p>Typical examples of type-1 devices is a Smart NIC - which may want to
directly operate on host-memory (DMA) to store incoming packets. These
devices largely rely on CPU-attached memory.</p>
</section>
<section id="type-2">
<h4>Type-2<a class="headerlink" href="#type-2" title="Link to this heading"></a></h4>
<p>A Type-2 CXL Device:</p>
<ul class="simple">
<li><p>Supports cxl.io, cxl.cache, and cxl.mem protocols</p></li>
<li><p>Optionally implements coherent cache and Host-Managed Device Memory</p></li>
<li><p>Is typically an accelerator device w/ high bandwidth memory.</p></li>
</ul>
<p>The primary difference between a type-1 and type-2 device is the presence
of host-managed device memory, which allows the device to operate on a
local memory bank - while the CPU sill has coherent DMA to the same memory.</p>
<p>The allows things like GPUs to expose their memory via DAX devices or file
descriptors, allows drivers and programs direct access to device memory
rather than use block-transfer semantics.</p>
</section>
<section id="type-3">
<h4>Type-3<a class="headerlink" href="#type-3" title="Link to this heading"></a></h4>
<p>A Type-3 CXL Device</p>
<ul class="simple">
<li><p>Supports cxl.io and cxl.mem</p></li>
<li><p>Implements Host-Managed Device Memory</p></li>
<li><p>May provide either Volatile or Persistent memory capacity (or both).</p></li>
</ul>
<p>A basic example of a type-3 device is a simple memory expanded, whose
local memory capacity is exposed to the CPU for access directly via
basic coherent DMA.</p>
</section>
<section id="switch">
<h4>Switch<a class="headerlink" href="#switch" title="Link to this heading"></a></h4>
<p>A CXL switch is a device capacity of routing any CXL (and by extension, PCIe)
protocol between an upstream, downstream, or peer devices.  Many devices, such
as Multi-Logical Devices, imply the presence of switching in some manner.</p>
</section>
<section id="logical-devices-and-heads">
<h4>Logical Devices and Heads<a class="headerlink" href="#logical-devices-and-heads" title="Link to this heading"></a></h4>
<p>A CXL device may present one or more “Logical Devices” to one or more hosts
(via physical “Heads”).</p>
<p>A Single-Logical Device (SLD) is a device which presents a single device to
one or more heads.</p>
<p>A Multi-Logical Device (MLD) is a device which may present multiple devices
to one or more devices.</p>
<p>A Single-Headed Device exposes only a single physical connection.</p>
<p>A Multi-Headed Device exposes multiple physical connections.</p>
<section id="mhsld">
<h5>MHSLD<a class="headerlink" href="#mhsld" title="Link to this heading"></a></h5>
<p>A Multi-Headed Single-Logical Device (MHSLD) exposes a single logical
device to multiple heads which may be connected to one or more discrete
hosts.  An example of this would be a simple memory-pool which may be
statically configured (prior to boot) to expose portions of its memory
to Linux via the CEDT ACPI table.</p>
</section>
<section id="mhmld">
<h5>MHMLD<a class="headerlink" href="#mhmld" title="Link to this heading"></a></h5>
<p>A Multi-Headed Multi-Logical Device (MHMLD) exposes multiple logical
devices to multiple heads which may be connected to one or more discrete
hosts.  An example of this would be a Dynamic Capacity Device or which
may be configured at runtime to expose portions of its memory to Linux.</p>
</section>
</section>
</section>
<section id="example-devices">
<h3>Example Devices<a class="headerlink" href="#example-devices" title="Link to this heading"></a></h3>
<section id="memory-expander">
<h4>Memory Expander<a class="headerlink" href="#memory-expander" title="Link to this heading"></a></h4>
<p>The simplest form of Type-3 device is a memory expander.  A memory expander
exposes Host-Managed Device Memory (HDM) to Linux.  This memory may be
Volatile or Non-Volatile (Persistent).</p>
<p>Memory Expanders will typically be considered a form of Single-Headed,
Single-Logical Device - as its form factor will typically be an add-in-card
(AIC) or some other similar form-factor.</p>
<p>The Linux CXL driver provides support for static or dynamic configuration of
basic memory expanders.  The platform may program decoders prior to OS init
(e.g. auto-decoders), or the user may program the fabric if the platform
defers these operations to the OS.</p>
<p>Multiple Memory Expanders may be added to an external chassis and exposed to
a host via a head attached to a CXL switch.  This is a “memory pool”, and
would be considered an MHSLD or MHMLD depending on the management capabilities
provided by the switch platform.</p>
<p>As of v6.14, Linux does not provide a formalized interface to manage non-DCD
MHSLD or MHMLD devices.</p>
</section>
<section id="dynamic-capacity-device-dcd">
<h4>Dynamic Capacity Device (DCD)<a class="headerlink" href="#dynamic-capacity-device-dcd" title="Link to this heading"></a></h4>
<p>A Dynamic Capacity Device is a Type-3 device which provides dynamic management
of memory capacity. The basic premise of a DCD to to provide an allocator-like
interface for physical memory capacity to a “Fabric Manager” (an external,
privileged host with privileges to change configurations for other hosts).</p>
<p>A DCD manages “Memory Extents”, which may be volatile or persistent. Extents
may also be exclusive to a single host or shared across multiple.</p>
<p>As of v6.14, Linux does not provide a formalized interface to manage DCD
devices, however there is active work on LKML targeting future release.</p>
</section>
<section id="example-t2-device">
<h4>Example T2 Device<a class="headerlink" href="#example-t2-device" title="Link to this heading"></a></h4>
<p>Todo</p>
</section>
</section>
</section>
<span id="document-devices/uefi"></span><section id="uefi-data">
<h2>UEFI Data<a class="headerlink" href="#uefi-data" title="Link to this heading"></a></h2>
<section id="coherent-device-attribute-table-cdat">
<h3>Coherent Device Attribute Table (CDAT)<a class="headerlink" href="#coherent-device-attribute-table-cdat" title="Link to this heading"></a></h3>
<p>todo</p>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-platform/bios-and-efi"></span><section id="bios-efi-configuration">
<h2>BIOS/EFI Configuration<a class="headerlink" href="#bios-efi-configuration" title="Link to this heading"></a></h2>
<p>BIOS and EFI are largely responsible for configuring static information about
devices (or potential future devices) such that Linux can build the appropriate
logical representations of these devices.</p>
<p>At a high level, this is what occurs during this phase of configuration.</p>
<ul class="simple">
<li><p>The bootloader starts the BIOS/EFI.</p></li>
<li><p>BIOS/EFI do early device probe to determine static configuration</p></li>
<li><p>BIOS/EFI creates ACPI Tables that describe static config for the OS</p></li>
<li><p>BIOS/EFI create the system memory map (EFI Memory Map, E820, etc)</p></li>
<li><p>BIOS/EFI calls <code class="code docutils literal notranslate"><span class="pre">start_kernel</span></code> and begins the Linux Early Boot process.</p></li>
</ul>
<p>Much of what this section is concerned with is ACPI Table production and
static memory map configuration. More detail on these tables can be found
under Platform Configuration -&gt; ACPI Table Reference.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Platform Vendors should read carefully, as this sections has recommendations
on physical memory region size and alignment, memory holes, HDM interleave,
and what linux expects of HDM decoders trying to work with these features.</p>
</div>
<section id="uefi-settings">
<h3>UEFI Settings<a class="headerlink" href="#uefi-settings" title="Link to this heading"></a></h3>
<p>If your platform supports it, the <code class="code docutils literal notranslate"><span class="pre">uefisettings</span></code> command can be used to
read/write EFI settings. Changes will be reflected on the next reboot. Kexec
is not a sufficient reboot.</p>
<p>One notable configuration here is the EFI_MEMORY_SP (Specific Purpose) bit.
When this is enabled, this bit tells linux to defer management of a memory
region to a driver (in this case, the CXL driver). Otherwise, the memory is
treated as “normal memory”, and is exposed to the page allocator during
<code class="code docutils literal notranslate"><span class="pre">__init</span></code>.</p>
<section id="uefisettings-examples">
<h4>uefisettings examples<a class="headerlink" href="#uefisettings-examples" title="Link to this heading"></a></h4>
<p><code class="code docutils literal notranslate"><span class="pre">uefisettings</span> <span class="pre">identify</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uefisettings</span> <span class="n">identify</span>

<span class="n">bios_vendor</span><span class="p">:</span> <span class="n">xxx</span>
<span class="n">bios_version</span><span class="p">:</span> <span class="n">xxx</span>
<span class="n">bios_release</span><span class="p">:</span> <span class="n">xxx</span>
<span class="n">bios_date</span><span class="p">:</span> <span class="n">xxx</span>
<span class="n">product_name</span><span class="p">:</span> <span class="n">xxx</span>
<span class="n">product_family</span><span class="p">:</span> <span class="n">xxx</span>
<span class="n">product_version</span><span class="p">:</span> <span class="n">xxx</span>
</pre></div>
</div>
<p>On some AMD platforms, the <code class="code docutils literal notranslate"><span class="pre">EFI_MEMORY_SP</span></code> bit is set via the <code class="code docutils literal notranslate"><span class="pre">CXL</span>
<span class="pre">Memory</span> <span class="pre">Attribute</span></code> field.  This may be called something else on your platform.</p>
<p><code class="code docutils literal notranslate"><span class="pre">uefisettings</span> <span class="pre">get</span> <span class="pre">&quot;CXL</span> <span class="pre">Memory</span> <span class="pre">Attribute&quot;</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">selector</span><span class="p">:</span> <span class="n">xxx</span>
<span class="o">...</span>
<span class="n">question</span><span class="p">:</span> <span class="n">Question</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;CXL Memory Attribute&quot;</span><span class="p">,</span>
    <span class="n">answer</span><span class="p">:</span> <span class="s2">&quot;Enabled&quot;</span><span class="p">,</span>
    <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="physical-memory-map">
<h3>Physical Memory Map<a class="headerlink" href="#physical-memory-map" title="Link to this heading"></a></h3>
<section id="physical-address-region-alignment">
<h4>Physical Address Region Alignment<a class="headerlink" href="#physical-address-region-alignment" title="Link to this heading"></a></h4>
<p>As of Linux v6.14, the hotplug memory system requires memory regions to be
uniform in size and alignment.  While the CXL specification allows for memory
regions as small as 256MB, the supported memory block size and alignment for
hotplugged memory is architecture-defined.</p>
<p>A Linux memory blocks may be as small as 128MB and increase in powers of two.</p>
<ul class="simple">
<li><p>On ARM, the default block size and alignment is either 128MB or 256MB.</p></li>
<li><p>On x86, the default block size is 256MB, and increases to 2GB as the
capacity of the system increases up to 64GB.</p></li>
</ul>
<p>For best support across versions, platform vendors should place CXL memory at
a 2GB aligned base address, and regions should be 2GB aligned.  This also helps
prevent the creating thousands of memory devices (one per block).</p>
</section>
<section id="memory-holes">
<h4>Memory Holes<a class="headerlink" href="#memory-holes" title="Link to this heading"></a></h4>
<p>Holes in the memory map are tricky.  Consider a 4GB device located at base
address 0x100000000, but with the following following memory map</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---------------------</span>
<span class="o">|</span>    <span class="mh">0x100000000</span>    <span class="o">|</span>
<span class="o">|</span>        <span class="n">CXL</span>        <span class="o">|</span>
<span class="o">|</span>    <span class="mh">0x1BFFFFFFF</span>    <span class="o">|</span>
<span class="o">---------------------</span>
<span class="o">|</span>    <span class="mh">0x1C0000000</span>    <span class="o">|</span>
<span class="o">|</span>    <span class="n">MEMORY</span> <span class="n">HOLE</span>    <span class="o">|</span>
<span class="o">|</span>    <span class="mh">0x1FFFFFFFF</span>    <span class="o">|</span>
<span class="o">---------------------</span>
<span class="o">|</span>    <span class="mh">0x200000000</span>    <span class="o">|</span>
<span class="o">|</span>     <span class="n">CXL</span> <span class="n">CONT</span><span class="o">.</span>     <span class="o">|</span>
<span class="o">|</span>    <span class="mh">0x23FFFFFFF</span>    <span class="o">|</span>
<span class="o">---------------------</span>
</pre></div>
</div>
<p>There are two issues to consider:</p>
<ul class="simple">
<li><p>decoder programming, and</p></li>
<li><p>memory block alignment.</p></li>
</ul>
<p>If your architecture requires 2GB uniform size and aligned memory blocks, the
only capacity Linux is capable of mapping (as of v6.14) would be the capacity
from <cite>0x100000000-0x180000000</cite>.  The remaining capacity will be stranded, as
they are not of 2GB aligned length.</p>
<p>Assuming your architecture and memory configuration allows 1GB memory blocks,
this memory map is supported and this should be presented as multiple CFMWS
in the CEDT that describe each side of the memory hole separately - along with
matching decoders.</p>
<p>Multiple decoders can (and should) be used to manage such a memory hole (see
below), but each chunk of a memory hole should be aligned to a reasonable block
size (larger alignment is always better).  If you intend to have memory holes
in the memory map, expect to use one decoder per contiguous chunk of host
physical memory.</p>
<p>As of v6.14, Linux does provide support for memory hotplug of multiple
physical memory regions separated by a memory hole described by a single
HDM decoder.</p>
</section>
</section>
<section id="decoder-programming">
<h3>Decoder Programming<a class="headerlink" href="#decoder-programming" title="Link to this heading"></a></h3>
<p>If BIOS/EFI intends to program the decoders to be statically configured,
there are a few things to consider to avoid major pitfalls that will
prevent Linux compatibility.  Some of these recommendations are not not
required “per the specification”, but Linux makes no guarantees of support
otherwise.</p>
<section id="translation-point">
<h4>Translation Point<a class="headerlink" href="#translation-point" title="Link to this heading"></a></h4>
<p>Per the specification, the only decoders which <strong>TRANSLATE</strong> Host Physical
Address (HPA) to Device Physical Address (DPA) are the <strong>Endpoint Decoders</strong>.
All other decoders in the fabric are intended to route accesses without
translating the addresses.</p>
<p>This is heavily implied by the specification, see:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CXL</span> <span class="n">Specification</span> <span class="mf">3.1</span>
<span class="mf">8.2.4.20</span><span class="p">:</span> <span class="n">CXL</span> <span class="n">HDM</span> <span class="n">Decoder</span> <span class="n">Capability</span> <span class="n">Structure</span>
<span class="o">-</span> <span class="n">Implementation</span> <span class="n">Note</span><span class="p">:</span> <span class="n">CXL</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="ow">and</span> <span class="n">Upstream</span> <span class="n">Switch</span> <span class="n">Port</span> <span class="n">Decoder</span> <span class="n">Flow</span>
<span class="o">-</span> <span class="n">Implementation</span> <span class="n">Note</span><span class="p">:</span> <span class="n">Device</span> <span class="n">Decoder</span> <span class="n">Logic</span>
</pre></div>
</div>
<p>Given this, Linux makes a strong assumption that decoders between CPU and
endpoint will all be programmed with addresses ranges that are subsets of
their parent decoder.</p>
<p>Due to some ambiguity in how Architecture, ACPI, PCI, and CXL specifications
“hand off” responsibility between domains, some early adopting platforms
attempted to do translation at the originating memory controller or host
bridge.  This configuration requires a platform specific extension to the
driver and is not officially endorsed - despite being supported.</p>
<p>It is <em>highly recommended</em> <strong>NOT</strong> to do this; otherwise, you are on your own
to implement driver support for your platform.</p>
</section>
<section id="interleave-and-configuration-flexibility">
<h4>Interleave and Configuration Flexibility<a class="headerlink" href="#interleave-and-configuration-flexibility" title="Link to this heading"></a></h4>
<p>If providing cross-host-bridge interleave, a CFMWS entry in the CEDT must be
presented with target host-bridges for the interleaved device sets (there may
be multiple behind each host bridge).</p>
<p>If providing intra-host-bridge interleaving, only 1 CFMWS entry in the CEDT is
required for that host bridge - if it covers the entire capacity of the devices
behind the host bridge.</p>
<p>If intending to provide users flexibility in programming decoders beyond the
root, you may want to provide multiple CFMWS entries in the CEDT intended for
different purposes.  For example, you may want to consider adding:</p>
<ol class="arabic simple">
<li><p>A CFMWS entry to cover all interleavable host bridges.</p></li>
<li><p>A CFMWS entry to cover all devices on a single host bridge.</p></li>
<li><p>A CFMWS entry to cover each device.</p></li>
</ol>
<p>A platform may choose to add all of these, or change the mode based on a BIOS
setting.  For each CFMWS entry, Linux expects descriptions of the described
memory regions in the SRAT to determine the number of NUMA nodes it should
reserve during early boot / init.</p>
<p>As of v6.14, Linux will create a NUMA node for each CEDT CFMWS entry, even if
a matching SRAT entry does not exist; however, this is not guaranteed in the
future and such a configuration should be avoided.</p>
</section>
<section id="id1">
<h4>Memory Holes<a class="headerlink" href="#id1" title="Link to this heading"></a></h4>
<p>If your platform includes memory holes intersparsed between your CXL memory, it
is recommended to utilize multiple decoders to cover these regions of memory,
rather than try to program the decoders to accept the entire range and expect
Linux to manage the overlap.</p>
<p>For example, consider the Memory Hole described above</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---------------------</span>
<span class="o">|</span>    <span class="mh">0x100000000</span>    <span class="o">|</span>
<span class="o">|</span>        <span class="n">CXL</span>        <span class="o">|</span>
<span class="o">|</span>    <span class="mh">0x1BFFFFFFF</span>    <span class="o">|</span>
<span class="o">---------------------</span>
<span class="o">|</span>    <span class="mh">0x1C0000000</span>    <span class="o">|</span>
<span class="o">|</span>    <span class="n">MEMORY</span> <span class="n">HOLE</span>    <span class="o">|</span>
<span class="o">|</span>    <span class="mh">0x1FFFFFFFF</span>    <span class="o">|</span>
<span class="o">---------------------</span>
<span class="o">|</span>    <span class="mh">0x200000000</span>    <span class="o">|</span>
<span class="o">|</span>     <span class="n">CXL</span> <span class="n">CONT</span><span class="o">.</span>     <span class="o">|</span>
<span class="o">|</span>    <span class="mh">0x23FFFFFFF</span>    <span class="o">|</span>
<span class="o">---------------------</span>
</pre></div>
</div>
<p>Assuming this is provided by a single device attached directly to a host bridge,
Linux would expect the following decoder programming</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-----------------------</span>   <span class="o">-----------------------</span>
<span class="o">|</span> <span class="n">root</span><span class="o">-</span><span class="n">decoder</span><span class="o">-</span><span class="mi">0</span>      <span class="o">|</span>   <span class="o">|</span> <span class="n">root</span><span class="o">-</span><span class="n">decoder</span><span class="o">-</span><span class="mi">1</span>      <span class="o">|</span>
<span class="o">|</span>   <span class="n">base</span><span class="p">:</span> <span class="mh">0x100000000</span> <span class="o">|</span>   <span class="o">|</span>   <span class="n">base</span><span class="p">:</span> <span class="mh">0x200000000</span> <span class="o">|</span>
<span class="o">|</span>   <span class="n">size</span><span class="p">:</span>  <span class="mh">0xC0000000</span> <span class="o">|</span>   <span class="o">|</span>   <span class="n">size</span><span class="p">:</span>  <span class="mh">0x40000000</span> <span class="o">|</span>
<span class="o">-----------------------</span>   <span class="o">-----------------------</span>
           <span class="o">|</span>                         <span class="o">|</span>
<span class="o">-----------------------</span>   <span class="o">-----------------------</span>
<span class="o">|</span> <span class="n">HB</span><span class="o">-</span><span class="n">decoder</span><span class="o">-</span><span class="mi">0</span>        <span class="o">|</span>   <span class="o">|</span> <span class="n">HB</span><span class="o">-</span><span class="n">decoder</span><span class="o">-</span><span class="mi">1</span>        <span class="o">|</span>
<span class="o">|</span>   <span class="n">base</span><span class="p">:</span> <span class="mh">0x100000000</span> <span class="o">|</span>   <span class="o">|</span>   <span class="n">base</span><span class="p">:</span> <span class="mh">0x200000000</span> <span class="o">|</span>
<span class="o">|</span>   <span class="n">size</span><span class="p">:</span>  <span class="mh">0xC0000000</span> <span class="o">|</span>   <span class="o">|</span>   <span class="n">size</span><span class="p">:</span>  <span class="mh">0x40000000</span> <span class="o">|</span>
<span class="o">-----------------------</span>   <span class="o">-----------------------</span>
           <span class="o">|</span>                         <span class="o">|</span>
<span class="o">-----------------------</span>   <span class="o">-----------------------</span>
<span class="o">|</span> <span class="n">ep</span><span class="o">-</span><span class="n">decoder</span><span class="o">-</span><span class="mi">0</span>        <span class="o">|</span>   <span class="o">|</span> <span class="n">ep</span><span class="o">-</span><span class="n">decoder</span><span class="o">-</span><span class="mi">1</span>        <span class="o">|</span>
<span class="o">|</span>   <span class="n">base</span><span class="p">:</span> <span class="mh">0x100000000</span> <span class="o">|</span>   <span class="o">|</span>   <span class="n">base</span><span class="p">:</span> <span class="mh">0x200000000</span> <span class="o">|</span>
<span class="o">|</span>   <span class="n">size</span><span class="p">:</span>  <span class="mh">0xC0000000</span> <span class="o">|</span>   <span class="o">|</span>   <span class="n">size</span><span class="p">:</span>  <span class="mh">0x40000000</span> <span class="o">|</span>
<span class="o">-----------------------</span>   <span class="o">-----------------------</span>
</pre></div>
</div>
<p>With a CEDT configuration with two CFMWS describing the above root decoders.</p>
<p>Linux makes no guarantee of support for strange memory hole situations.</p>
</section>
<section id="multi-media-devices">
<h4>Multi-Media Devices<a class="headerlink" href="#multi-media-devices" title="Link to this heading"></a></h4>
<p>The CFMWS field of the CEDT has special restriction bits which describe whether
the described memory region allows volatile or persistent memory (or both). If
the platform intends to support either:</p>
<ol class="arabic simple">
<li><p>A device with multiple medias, or</p></li>
<li><p>Using a persistent memory device as normal memory</p></li>
</ol>
<p>A platform may wish to create multiple CEDT CFMWS entries to describe the same
memory, with the intent of allowing the end user flexibility in how that memory
is configured. Linux does not presently have strong requirements in this area.</p>
</section>
</section>
</section>
<span id="document-platform/acpi"></span><section id="acpi-tables">
<h2>ACPI Tables<a class="headerlink" href="#acpi-tables" title="Link to this heading"></a></h2>
<p>ACPI is the “Advanced Configuration and Power Interface”, which is a standard
that defines how platforms and OS manage pwoer and configure computer hardware.
For the purpose of this theory of operation, when referring to “ACPI” we will
usually refer to “ACPI Tables” - which are the way a platform (BIOS/EFI)
communicates static configuration information to the operation system.</p>
<p>The Following ACPI tables contain <em>static</em> configuration and performance data about CXL devices.</p>
<div class="toctree-wrapper compound">
<span id="document-platform/acpi/cedt"></span><section id="cedt-cxl-early-discovery-table">
<h3>CEDT - CXL Early Discovery Table<a class="headerlink" href="#cedt-cxl-early-discovery-table" title="Link to this heading"></a></h3>
<p>The CXL Early Discovery Table is generated by BIOS to describe the CXL memory regions configured at boot by the BIOS.</p>
<section id="chbs">
<h4>CHBS<a class="headerlink" href="#chbs" title="Link to this heading"></a></h4>
<p>The CXL Host Bridge Structure describes CXL host bridges.  Other than describing device register information, it reports the specific host bridge UID for this host bridge.  These host bridge ID’s will be referenced in other tables.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>         <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">00</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="n">Structure</span><span class="p">]</span>
              <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                <span class="n">Length</span> <span class="p">:</span> <span class="mi">0020</span>
<span class="n">Associated</span> <span class="n">host</span> <span class="n">bridge</span> <span class="p">:</span> <span class="mi">00000007</span>    <span class="o">&lt;-</span> <span class="n">Host</span> <span class="n">bridge</span> <span class="n">_UID</span>
 <span class="n">Specification</span> <span class="n">version</span> <span class="p">:</span> <span class="mi">00000001</span>
              <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
         <span class="n">Register</span> <span class="n">base</span> <span class="p">:</span> <span class="mi">0000010370400000</span>
       <span class="n">Register</span> <span class="n">length</span> <span class="p">:</span> <span class="mi">0000000000010000</span>
</pre></div>
</div>
</section>
<section id="cfmws">
<h4>CFMWS<a class="headerlink" href="#cfmws" title="Link to this heading"></a></h4>
<p>The CXL Fixed Memory Window structure describes a memory region associated with one or more CXL host bridges (as described by the CHBS).  It additionally describes any inter-host-bridge interleave configuration that may have been programmed by BIOS.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Fixed</span> <span class="n">Memory</span> <span class="n">Window</span> <span class="n">Structure</span><span class="p">]</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                  <span class="n">Length</span> <span class="p">:</span> <span class="mi">002</span><span class="n">C</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
     <span class="n">Window</span> <span class="n">base</span> <span class="n">address</span> <span class="p">:</span> <span class="mi">000000</span><span class="n">C050000000</span>   <span class="o">&lt;-</span> <span class="n">Memory</span> <span class="n">Region</span>
             <span class="n">Window</span> <span class="n">size</span> <span class="p">:</span> <span class="mi">0000003</span><span class="n">CA0000000</span>
<span class="n">Interleave</span> <span class="n">Members</span> <span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="n">n</span><span class="p">)</span> <span class="p">:</span> <span class="mi">01</span>                 <span class="o">&lt;-</span> <span class="n">Interleave</span> <span class="n">configuration</span>
   <span class="n">Interleave</span> <span class="n">Arithmetic</span> <span class="p">:</span> <span class="mi">00</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">0000</span>
             <span class="n">Granularity</span> <span class="p">:</span> <span class="mi">00000000</span>
            <span class="n">Restrictions</span> <span class="p">:</span> <span class="mi">0006</span>
                   <span class="n">QtgId</span> <span class="p">:</span> <span class="mi">0001</span>
            <span class="n">First</span> <span class="n">Target</span> <span class="p">:</span> <span class="mi">00000007</span>           <span class="o">&lt;-</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="n">_UID</span>
             <span class="n">Next</span> <span class="n">Target</span> <span class="p">:</span> <span class="mi">00000006</span>           <span class="o">&lt;-</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="n">_UID</span>
</pre></div>
</div>
<p>The restriction field dictates what this SPA range may be used for (memory type, voltile vs persistent, etc). One or more bits may be set.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Bit</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">CXL</span> <span class="n">Type</span> <span class="mi">2</span> <span class="n">Memory</span>
<span class="n">Bit</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">CXL</span> <span class="n">Type</span> <span class="mi">3</span> <span class="n">Memory</span>
<span class="n">Bit</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">Volatile</span> <span class="n">Memory</span>
<span class="n">Bit</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">Persistent</span> <span class="n">Memory</span>
<span class="n">Bit</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">Fixed</span> <span class="n">Config</span> <span class="p">(</span><span class="n">HPA</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">re</span><span class="o">-</span><span class="n">used</span><span class="p">)</span>
</pre></div>
</div>
<p>INTRA-host-bridge interleave (multiple devices on one host bridge) is NOT reported in this structure, and is solely defined via CXL device decoder programming (host bridge and endpoint decoders).</p>
</section>
</section>
<span id="document-platform/acpi/srat"></span><section id="srat-static-resource-affinity-table">
<h3>SRAT - Static Resource Affinity Table<a class="headerlink" href="#srat-static-resource-affinity-table" title="Link to this heading"></a></h3>
<p>The System/Static Resource Affinity Table describes resource (CPU, Memory) affinity to “Proximity Domains”. This table is technically optional, but for performance information (see “HMAT”) to be enumerated by linux it must be present.</p>
<p>There is a careful dance between the CEDT and SRAT tables and how NUMA nodes are created.  If things don’t look quite the way you expect - check the SRAT Memory Affinity entries and CEDT CFMWS to determine what your platform actually supports in terms of flexible topologies.</p>
<p>The SRAT may statically assign portions of a CFMWS SPA range to a specific proximity domains.  See linux numa creation for more information about how this presents in the NUMA topology.</p>
<section id="proximity-domain">
<h4>Proximity Domain<a class="headerlink" href="#proximity-domain" title="Link to this heading"></a></h4>
<p>A proximity domain is ROUGHLY equivalent to “NUMA Node” - though a 1-to-1 mapping is not guaranteed.  There are scenarios where “Proximity Domain 4” may map to “NUMA Node 3”, for example.  (See “NUMA Node Creation”)</p>
</section>
<section id="memory-affinity">
<h4>Memory Affinity<a class="headerlink" href="#memory-affinity" title="Link to this heading"></a></h4>
<p>Generally speaking, if a host does any amount of CXL fabric (decoder) programming in BIOS - an SRAT entry for that memory needs to be present.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">Memory</span> <span class="n">Affinity</span><span class="p">]</span>
               <span class="n">Length</span> <span class="p">:</span> <span class="mi">28</span>
     <span class="n">Proximity</span> <span class="n">Domain</span> <span class="p">:</span> <span class="mi">00000001</span>          <span class="o">&lt;-</span> <span class="n">NUMA</span> <span class="n">Node</span> <span class="mi">1</span>
            <span class="n">Reserved1</span> <span class="p">:</span> <span class="mi">0000</span>
         <span class="n">Base</span> <span class="n">Address</span> <span class="p">:</span> <span class="mi">000000</span><span class="n">C050000000</span>  <span class="o">&lt;-</span> <span class="n">Physical</span> <span class="n">Memory</span> <span class="n">Region</span>
       <span class="n">Address</span> <span class="n">Length</span> <span class="p">:</span> <span class="mi">0000003</span><span class="n">CA0000000</span>
            <span class="n">Reserved2</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Flags</span> <span class="p">(</span><span class="n">decoded</span> <span class="n">below</span><span class="p">)</span> <span class="p">:</span> <span class="mi">0000000</span><span class="n">B</span>
             <span class="n">Enabled</span> <span class="p">:</span> <span class="mi">1</span>
       <span class="n">Hot</span> <span class="n">Pluggable</span> <span class="p">:</span> <span class="mi">1</span>
        <span class="n">Non</span><span class="o">-</span><span class="n">Volatile</span> <span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
</section>
<section id="generic-initiator-port">
<h4>Generic Initiator / Port<a class="headerlink" href="#generic-initiator-port" title="Link to this heading"></a></h4>
<p>todo</p>
</section>
</section>
<span id="document-platform/acpi/hmat"></span><section id="hmat-heterogeneous-memory-attribute-table">
<h3>HMAT - Heterogeneous Memory Attribute Table<a class="headerlink" href="#hmat-heterogeneous-memory-attribute-table" title="Link to this heading"></a></h3>
<p>The Heterogeneous Memory Attributes Table contains information such as cache attributes and bandwidth and latency details for memory proximity domains.  For the purpose of this document, we will only discuss the SSLIB entry.</p>
<section id="sllbi">
<h4>SLLBI<a class="headerlink" href="#sllbi" title="Link to this heading"></a></h4>
<p>The System Locality Latency and Bandwidth Information records latency and bandwidth information for proximity domains.</p>
<p>This table is used by Linux to configure interleave weights and memory tiers.</p>
<p>Example (Heavily truncated for brevity)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>              <span class="n">Structure</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">0001</span> <span class="p">[</span><span class="n">SLLBI</span><span class="p">]</span>
                   <span class="n">Data</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">00</span>         <span class="o">&lt;-</span> <span class="n">Latency</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000001</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0080</span>       <span class="o">&lt;-</span> <span class="n">DRAM</span> <span class="n">LTC</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0100</span>       <span class="o">&lt;-</span> <span class="n">CXL</span> <span class="n">LTC</span>

              <span class="n">Structure</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">0001</span> <span class="p">[</span><span class="n">SLLBI</span><span class="p">]</span>
                   <span class="n">Data</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">03</span>         <span class="o">&lt;-</span> <span class="n">Bandwidth</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000001</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">1200</span>       <span class="o">&lt;-</span> <span class="n">DRAM</span> <span class="n">BW</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0200</span>       <span class="o">&lt;-</span> <span class="n">CXL</span> <span class="n">BW</span>
</pre></div>
</div>
</section>
</section>
<span id="document-platform/acpi/slit"></span><section id="slit-system-locality-information-table">
<h3>SLIT - System Locality Information Table<a class="headerlink" href="#slit-system-locality-information-table" title="Link to this heading"></a></h3>
<p>The system locality information table provides “abstract distances” between accessor and memory nodes.  Node without initiators (cpus) are infinitely (FF) distance away from all other nodes.</p>
<p>The abstract distance described in this table does not describe any real latency of bandwidth information.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">Signature</span> <span class="p">:</span> <span class="s2">&quot;SLIT&quot;</span>    <span class="p">[</span><span class="n">System</span> <span class="n">Locality</span> <span class="n">Information</span> <span class="n">Table</span><span class="p">]</span>
  <span class="n">Localities</span> <span class="p">:</span> <span class="mi">0000000000000004</span>
<span class="n">Locality</span>   <span class="mi">0</span> <span class="p">:</span> <span class="mi">10</span> <span class="mi">20</span> <span class="mi">20</span> <span class="mi">30</span>
<span class="n">Locality</span>   <span class="mi">1</span> <span class="p">:</span> <span class="mi">20</span> <span class="mi">10</span> <span class="mi">30</span> <span class="mi">20</span>
<span class="n">Locality</span>   <span class="mi">2</span> <span class="p">:</span> <span class="n">FF</span> <span class="n">FF</span> <span class="mi">0</span><span class="n">A</span> <span class="n">FF</span>
<span class="n">Locality</span>   <span class="mi">3</span> <span class="p">:</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="mi">0</span><span class="n">A</span>
</pre></div>
</div>
</section>
<span id="document-platform/acpi/dsdt"></span><section id="dsdt-differentiated-system-description-table">
<h3>DSDT - Differentiated system Description Table<a class="headerlink" href="#dsdt-differentiated-system-description-table" title="Link to this heading"></a></h3>
<p>This table describes what peripherals a machine has.</p>
<p>This table’s UIDs for CXL devices - specifically host bridges, must be
consistent with the contents of the CEDT, otherwise the CXL driver will
fail to probe correctly.</p>
<p>Example Compute Express Link Host Bridge</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Scope</span> <span class="p">(</span><span class="n">_SB</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Device</span> <span class="p">(</span><span class="n">S0D0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Name</span> <span class="p">(</span><span class="n">_HID</span><span class="p">,</span> <span class="s2">&quot;ACPI0016&quot;</span> <span class="o">/*</span> <span class="n">Compute</span> <span class="n">Express</span> <span class="n">Link</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="o">*/</span><span class="p">)</span>  <span class="o">//</span> <span class="n">_HID</span><span class="p">:</span> <span class="n">Hardware</span> <span class="n">ID</span>
        <span class="n">Name</span> <span class="p">(</span><span class="n">_CID</span><span class="p">,</span> <span class="n">Package</span> <span class="p">(</span><span class="mh">0x02</span><span class="p">)</span>  <span class="o">//</span> <span class="n">_CID</span><span class="p">:</span> <span class="n">Compatible</span> <span class="n">ID</span>
        <span class="p">{</span>
            <span class="n">EisaId</span> <span class="p">(</span><span class="s2">&quot;PNP0A08&quot;</span><span class="p">)</span> <span class="o">/*</span> <span class="n">PCI</span> <span class="n">Express</span> <span class="n">Bus</span> <span class="o">*/</span><span class="p">,</span>
            <span class="n">EisaId</span> <span class="p">(</span><span class="s2">&quot;PNP0A03&quot;</span><span class="p">)</span> <span class="o">/*</span> <span class="n">PCI</span> <span class="n">Bus</span> <span class="o">*/</span>
        <span class="p">})</span>
        <span class="o">...</span>
        <span class="n">Name</span> <span class="p">(</span><span class="n">_UID</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">)</span>  <span class="o">//</span> <span class="n">_UID</span><span class="p">:</span> <span class="n">Unique</span> <span class="n">ID</span>
        <span class="o">...</span>
  <span class="p">}</span>
</pre></div>
</div>
</section>
</div>
<p>The SRAT table may also contain generic port/initiator content that is intended to describe the generic port, but not information about the rest of the path to the endpoint.</p>
<p>Linux uses these tables to configure kernel resources for statically configured (by BIOS/EFI) CXL devices, such as:</p>
<ul class="simple">
<li><p>NUMA nodes</p></li>
<li><p>Memory Tiers</p></li>
<li><p>NUMA Abstract Distances</p></li>
<li><p>SystemRAM Memory Regions</p></li>
<li><p>Weighted Interleave Node Weights</p></li>
</ul>
<section id="acpi-debugging">
<h3>ACPI Debugging<a class="headerlink" href="#acpi-debugging" title="Link to this heading"></a></h3>
<p>The <code class="code docutils literal notranslate"><span class="pre">acpidump</span> <span class="pre">-b</span></code> command dumps the ACPI tables into binary format.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">iasl</span> <span class="pre">-d</span></code> command disassembles the files into human readable format.</p>
<p>Example <code class="code docutils literal notranslate"><span class="pre">acpidump</span> <span class="pre">-b</span> <span class="pre">&amp;&amp;</span> <span class="pre">iasl</span> <span class="pre">-d</span> <span class="pre">cedt.dat</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span>
 <span class="o">*</span> <span class="n">Intel</span> <span class="n">ACPI</span> <span class="n">Component</span> <span class="n">Architecture</span>
 <span class="o">*</span> <span class="n">AML</span><span class="o">/</span><span class="n">ASL</span><span class="o">+</span> <span class="n">Disassembler</span> <span class="n">version</span> <span class="mi">20210604</span> <span class="p">(</span><span class="mi">64</span><span class="o">-</span><span class="n">bit</span> <span class="n">version</span><span class="p">)</span>
 <span class="o">*</span> <span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">2000</span> <span class="o">-</span> <span class="mi">2021</span> <span class="n">Intel</span> <span class="n">Corporation</span>
 <span class="o">*</span>
 <span class="o">*</span> <span class="n">Disassembly</span> <span class="n">of</span> <span class="n">cedt</span><span class="o">.</span><span class="n">dat</span><span class="p">,</span> <span class="n">Fri</span> <span class="n">Apr</span> <span class="mi">11</span> <span class="mi">07</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">31</span> <span class="mi">2025</span>
 <span class="o">*</span>
 <span class="o">*</span> <span class="n">ACPI</span> <span class="n">Data</span> <span class="n">Table</span> <span class="p">[</span><span class="n">CEDT</span><span class="p">]</span>
 <span class="o">*</span>
 <span class="o">*</span> <span class="n">Format</span><span class="p">:</span> <span class="p">[</span><span class="n">HexOffset</span> <span class="n">DecimalOffset</span> <span class="n">ByteLength</span><span class="p">]</span>  <span class="n">FieldName</span> <span class="p">:</span> <span class="n">FieldValue</span>
 <span class="o">*/</span>
 <span class="p">[</span><span class="mi">000</span><span class="n">h</span> <span class="mi">0000</span>   <span class="mi">4</span><span class="p">]</span>   <span class="n">Signature</span> <span class="p">:</span> <span class="s2">&quot;CEDT&quot;</span>    <span class="p">[</span><span class="n">CXL</span> <span class="n">Early</span> <span class="n">Discovery</span> <span class="n">Table</span><span class="p">]</span>
 <span class="o">...</span>
</pre></div>
</div>
<section id="common-issues">
<h4>Common Issues<a class="headerlink" href="#common-issues" title="Link to this heading"></a></h4>
<p>Most failures described here result in a failure of the driver to surface
memory as a DAX device and/or kmem.</p>
<ul class="simple">
<li><p>CEDT CFMWS targets list UIDs do not match CEDT CHBS UIDs.</p></li>
<li><p>CEDT CFMWS targets list UIDs do not match DSDT CXL Host Bridge UIDs.</p></li>
<li><p>CEDT CFMWS Restriction Bits are not correct.</p></li>
<li><p>CEDT CFMWS Memory regions are poorly aligned.</p></li>
<li><p>CEDT CFMWS Memory regions spans a platform memory hole.</p></li>
<li><p>CEDT CHBS UIDs do not match DSDT CXL Host Bridge UIDs.</p></li>
<li><p>CEDT CHBS Specification version is incorrect.</p></li>
<li><p>SRAT is missing regions described in CEDT CFMWS.</p>
<ul>
<li><p>Result: failure to create a NUMA node for the region, or
region is placed in wrong node.</p></li>
</ul>
</li>
<li><p>HMAT is missing data for regions described in CEDT CFMWS.</p>
<ul>
<li><p>Result: NUMA node being placed in the wrong memory tier.</p></li>
</ul>
</li>
<li><p>SLIT has bad data.</p>
<ul>
<li><p>Result: Lots of performance mechanisms in the kernel will be very unhappy.</p></li>
</ul>
</li>
</ul>
<p>All of these issues will appear to users as if the driver is failing to
support CXL - when in reality they are all the failure of a platform to
configure the ACPI tables correctly.</p>
</section>
</section>
</section>
<span id="document-platform/example-configs"></span><section id="example-platform-configurations">
<h2>Example Platform Configurations<a class="headerlink" href="#example-platform-configurations" title="Link to this heading"></a></h2>
<div class="toctree-wrapper compound">
<span id="document-platform/example-configurations/one-dev-per-hb"></span><section id="one-device-per-host-bridge">
<h3>One Device per Host Bridge<a class="headerlink" href="#one-device-per-host-bridge" title="Link to this heading"></a></h3>
<p>This system has a single socket with two CXL host bridges. Each host bridge
has a single CXL memory expander with a 4GB of memory.</p>
<p>Things to note:</p>
<ul class="simple">
<li><p>Cross-Bridge interleave is not being used.</p></li>
<li><p>The expanders are in two separate but adjascent memory regions.</p></li>
<li><p>This CEDT/SRAT describes one-node per device</p></li>
<li><p>The expanders have the same performance and will be in the same memory tier.</p></li>
</ul>
<p>CEDT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">00</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="n">Structure</span><span class="p">]</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                  <span class="n">Length</span> <span class="p">:</span> <span class="mi">0020</span>
  <span class="n">Associated</span> <span class="n">host</span> <span class="n">bridge</span> <span class="p">:</span> <span class="mi">00000007</span>
   <span class="n">Specification</span> <span class="n">version</span> <span class="p">:</span> <span class="mi">00000001</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
           <span class="n">Register</span> <span class="n">base</span> <span class="p">:</span> <span class="mi">0000010370400000</span>
         <span class="n">Register</span> <span class="n">length</span> <span class="p">:</span> <span class="mi">0000000000010000</span>

           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">00</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="n">Structure</span><span class="p">]</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                  <span class="n">Length</span> <span class="p">:</span> <span class="mi">0020</span>
  <span class="n">Associated</span> <span class="n">host</span> <span class="n">bridge</span> <span class="p">:</span> <span class="mi">00000006</span>
   <span class="n">Specification</span> <span class="n">version</span> <span class="p">:</span> <span class="mi">00000001</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
           <span class="n">Register</span> <span class="n">base</span> <span class="p">:</span> <span class="mi">0000010380800000</span>
         <span class="n">Register</span> <span class="n">length</span> <span class="p">:</span> <span class="mi">0000000000010000</span>

           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Fixed</span> <span class="n">Memory</span> <span class="n">Window</span> <span class="n">Structure</span><span class="p">]</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                  <span class="n">Length</span> <span class="p">:</span> <span class="mi">002</span><span class="n">C</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
     <span class="n">Window</span> <span class="n">base</span> <span class="n">address</span> <span class="p">:</span> <span class="mi">0000001000000000</span>
             <span class="n">Window</span> <span class="n">size</span> <span class="p">:</span> <span class="mi">0000000100000000</span>
<span class="n">Interleave</span> <span class="n">Members</span> <span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="n">n</span><span class="p">)</span> <span class="p">:</span> <span class="mi">00</span>
   <span class="n">Interleave</span> <span class="n">Arithmetic</span> <span class="p">:</span> <span class="mi">00</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">0000</span>
             <span class="n">Granularity</span> <span class="p">:</span> <span class="mi">00000000</span>
            <span class="n">Restrictions</span> <span class="p">:</span> <span class="mi">0006</span>
                   <span class="n">QtgId</span> <span class="p">:</span> <span class="mi">0001</span>
            <span class="n">First</span> <span class="n">Target</span> <span class="p">:</span> <span class="mi">00000007</span>

           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Fixed</span> <span class="n">Memory</span> <span class="n">Window</span> <span class="n">Structure</span><span class="p">]</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                  <span class="n">Length</span> <span class="p">:</span> <span class="mi">002</span><span class="n">C</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
     <span class="n">Window</span> <span class="n">base</span> <span class="n">address</span> <span class="p">:</span> <span class="mi">0000001100000000</span>
             <span class="n">Window</span> <span class="n">size</span> <span class="p">:</span> <span class="mi">0000000100000000</span>
<span class="n">Interleave</span> <span class="n">Members</span> <span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="n">n</span><span class="p">)</span> <span class="p">:</span> <span class="mi">00</span>
   <span class="n">Interleave</span> <span class="n">Arithmetic</span> <span class="p">:</span> <span class="mi">00</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">0000</span>
             <span class="n">Granularity</span> <span class="p">:</span> <span class="mi">00000000</span>
            <span class="n">Restrictions</span> <span class="p">:</span> <span class="mi">0006</span>
                   <span class="n">QtgId</span> <span class="p">:</span> <span class="mi">0001</span>
            <span class="n">First</span> <span class="n">Target</span> <span class="p">:</span> <span class="mi">00000006</span>
</pre></div>
</div>
<p>SRAT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">Memory</span> <span class="n">Affinity</span><span class="p">]</span>
               <span class="n">Length</span> <span class="p">:</span> <span class="mi">28</span>
     <span class="n">Proximity</span> <span class="n">Domain</span> <span class="p">:</span> <span class="mi">00000001</span>
            <span class="n">Reserved1</span> <span class="p">:</span> <span class="mi">0000</span>
         <span class="n">Base</span> <span class="n">Address</span> <span class="p">:</span> <span class="mi">0000001000000000</span>
       <span class="n">Address</span> <span class="n">Length</span> <span class="p">:</span> <span class="mi">0000000100000000</span>
            <span class="n">Reserved2</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Flags</span> <span class="p">(</span><span class="n">decoded</span> <span class="n">below</span><span class="p">)</span> <span class="p">:</span> <span class="mi">0000000</span><span class="n">B</span>
            <span class="n">Enabled</span> <span class="p">:</span> <span class="mi">1</span>
      <span class="n">Hot</span> <span class="n">Pluggable</span> <span class="p">:</span> <span class="mi">1</span>
       <span class="n">Non</span><span class="o">-</span><span class="n">Volatile</span> <span class="p">:</span> <span class="mi">0</span>

        <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">Memory</span> <span class="n">Affinity</span><span class="p">]</span>
               <span class="n">Length</span> <span class="p">:</span> <span class="mi">28</span>
     <span class="n">Proximity</span> <span class="n">Domain</span> <span class="p">:</span> <span class="mi">00000002</span>
            <span class="n">Reserved1</span> <span class="p">:</span> <span class="mi">0000</span>
         <span class="n">Base</span> <span class="n">Address</span> <span class="p">:</span> <span class="mi">0000001100000000</span>
       <span class="n">Address</span> <span class="n">Length</span> <span class="p">:</span> <span class="mi">0000000100000000</span>
            <span class="n">Reserved2</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Flags</span> <span class="p">(</span><span class="n">decoded</span> <span class="n">below</span><span class="p">)</span> <span class="p">:</span> <span class="mi">0000000</span><span class="n">B</span>
            <span class="n">Enabled</span> <span class="p">:</span> <span class="mi">1</span>
      <span class="n">Hot</span> <span class="n">Pluggable</span> <span class="p">:</span> <span class="mi">1</span>
       <span class="n">Non</span><span class="o">-</span><span class="n">Volatile</span> <span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>HMAT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>              <span class="n">Structure</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">0001</span> <span class="p">[</span><span class="n">SLLBI</span><span class="p">]</span>
                   <span class="n">Data</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">00</span>   <span class="p">[</span><span class="n">Latency</span><span class="p">]</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000001</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000002</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0080</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0100</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0100</span>

              <span class="n">Structure</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">0001</span> <span class="p">[</span><span class="n">SLLBI</span><span class="p">]</span>
                   <span class="n">Data</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">03</span>   <span class="p">[</span><span class="n">Bandwidth</span><span class="p">]</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000001</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000002</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">1200</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0200</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0200</span>
</pre></div>
</div>
<p>SLIT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">Signature</span> <span class="p">:</span> <span class="s2">&quot;SLIT&quot;</span>    <span class="p">[</span><span class="n">System</span> <span class="n">Locality</span> <span class="n">Information</span> <span class="n">Table</span><span class="p">]</span>
  <span class="n">Localities</span> <span class="p">:</span> <span class="mi">0000000000000003</span>
<span class="n">Locality</span>   <span class="mi">0</span> <span class="p">:</span> <span class="mi">10</span> <span class="mi">20</span> <span class="mi">20</span>
<span class="n">Locality</span>   <span class="mi">1</span> <span class="p">:</span> <span class="n">FF</span> <span class="mi">0</span><span class="n">A</span> <span class="n">FF</span>
<span class="n">Locality</span>   <span class="mi">2</span> <span class="p">:</span> <span class="n">FF</span> <span class="n">FF</span> <span class="mi">0</span><span class="n">A</span>
</pre></div>
</div>
<p>DSDT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Scope</span> <span class="p">(</span><span class="n">_SB</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Device</span> <span class="p">(</span><span class="n">S0D0</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="n">Name</span> <span class="p">(</span><span class="n">_HID</span><span class="p">,</span> <span class="s2">&quot;ACPI0016&quot;</span> <span class="o">/*</span> <span class="n">Compute</span> <span class="n">Express</span> <span class="n">Link</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="o">*/</span><span class="p">)</span>  <span class="o">//</span> <span class="n">_HID</span><span class="p">:</span> <span class="n">Hardware</span> <span class="n">ID</span>
      <span class="o">...</span>
      <span class="n">Name</span> <span class="p">(</span><span class="n">_UID</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">)</span>  <span class="o">//</span> <span class="n">_UID</span><span class="p">:</span> <span class="n">Unique</span> <span class="n">ID</span>
  <span class="p">}</span>
  <span class="o">...</span>
  <span class="n">Device</span> <span class="p">(</span><span class="n">S0D5</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="n">Name</span> <span class="p">(</span><span class="n">_HID</span><span class="p">,</span> <span class="s2">&quot;ACPI0016&quot;</span> <span class="o">/*</span> <span class="n">Compute</span> <span class="n">Express</span> <span class="n">Link</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="o">*/</span><span class="p">)</span>  <span class="o">//</span> <span class="n">_HID</span><span class="p">:</span> <span class="n">Hardware</span> <span class="n">ID</span>
      <span class="o">...</span>
      <span class="n">Name</span> <span class="p">(</span><span class="n">_UID</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">)</span>  <span class="o">//</span> <span class="n">_UID</span><span class="p">:</span> <span class="n">Unique</span> <span class="n">ID</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<span id="document-platform/example-configurations/multi-dev-per-hb"></span><section id="multiple-devices-per-host-bridge">
<h3>Multiple Devices per Host Bridge<a class="headerlink" href="#multiple-devices-per-host-bridge" title="Link to this heading"></a></h3>
<p>In this example system we will have a single socket and one CXL host bridge.
There are two CXL memory expanders with 4GB attached to the host bridge.</p>
<p>Things to note:</p>
<ul class="simple">
<li><p>Intra-Bridge interleave is not described here.</p></li>
<li><p>The expanders are described by a single CEDT/CFMWS.</p></li>
<li><p>This CEDT/SRAT describes one node for both devices.</p></li>
<li><p>There is only one proximity domain the HMAT for both devices.</p></li>
</ul>
<p>CEDT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">00</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="n">Structure</span><span class="p">]</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                  <span class="n">Length</span> <span class="p">:</span> <span class="mi">0020</span>
  <span class="n">Associated</span> <span class="n">host</span> <span class="n">bridge</span> <span class="p">:</span> <span class="mi">00000007</span>
   <span class="n">Specification</span> <span class="n">version</span> <span class="p">:</span> <span class="mi">00000001</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
           <span class="n">Register</span> <span class="n">base</span> <span class="p">:</span> <span class="mi">0000010370400000</span>
         <span class="n">Register</span> <span class="n">length</span> <span class="p">:</span> <span class="mi">0000000000010000</span>

           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Fixed</span> <span class="n">Memory</span> <span class="n">Window</span> <span class="n">Structure</span><span class="p">]</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                  <span class="n">Length</span> <span class="p">:</span> <span class="mi">002</span><span class="n">C</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
     <span class="n">Window</span> <span class="n">base</span> <span class="n">address</span> <span class="p">:</span> <span class="mi">0000001000000000</span>
             <span class="n">Window</span> <span class="n">size</span> <span class="p">:</span> <span class="mi">0000000200000000</span>
<span class="n">Interleave</span> <span class="n">Members</span> <span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="n">n</span><span class="p">)</span> <span class="p">:</span> <span class="mi">00</span>
   <span class="n">Interleave</span> <span class="n">Arithmetic</span> <span class="p">:</span> <span class="mi">00</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">0000</span>
             <span class="n">Granularity</span> <span class="p">:</span> <span class="mi">00000000</span>
            <span class="n">Restrictions</span> <span class="p">:</span> <span class="mi">0006</span>
                   <span class="n">QtgId</span> <span class="p">:</span> <span class="mi">0001</span>
            <span class="n">First</span> <span class="n">Target</span> <span class="p">:</span> <span class="mi">00000007</span>
</pre></div>
</div>
<p>SRAT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">Memory</span> <span class="n">Affinity</span><span class="p">]</span>
               <span class="n">Length</span> <span class="p">:</span> <span class="mi">28</span>
     <span class="n">Proximity</span> <span class="n">Domain</span> <span class="p">:</span> <span class="mi">00000001</span>
            <span class="n">Reserved1</span> <span class="p">:</span> <span class="mi">0000</span>
         <span class="n">Base</span> <span class="n">Address</span> <span class="p">:</span> <span class="mi">0000001000000000</span>
       <span class="n">Address</span> <span class="n">Length</span> <span class="p">:</span> <span class="mi">0000000200000000</span>
            <span class="n">Reserved2</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Flags</span> <span class="p">(</span><span class="n">decoded</span> <span class="n">below</span><span class="p">)</span> <span class="p">:</span> <span class="mi">0000000</span><span class="n">B</span>
            <span class="n">Enabled</span> <span class="p">:</span> <span class="mi">1</span>
      <span class="n">Hot</span> <span class="n">Pluggable</span> <span class="p">:</span> <span class="mi">1</span>
       <span class="n">Non</span><span class="o">-</span><span class="n">Volatile</span> <span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>HMAT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>              <span class="n">Structure</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">0001</span> <span class="p">[</span><span class="n">SLLBI</span><span class="p">]</span>
                   <span class="n">Data</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">00</span>   <span class="p">[</span><span class="n">Latency</span><span class="p">]</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000001</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0080</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0100</span>

              <span class="n">Structure</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">0001</span> <span class="p">[</span><span class="n">SLLBI</span><span class="p">]</span>
                   <span class="n">Data</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">03</span>   <span class="p">[</span><span class="n">Bandwidth</span><span class="p">]</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000001</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">1200</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0200</span>
</pre></div>
</div>
<p>SLIT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">Signature</span> <span class="p">:</span> <span class="s2">&quot;SLIT&quot;</span>    <span class="p">[</span><span class="n">System</span> <span class="n">Locality</span> <span class="n">Information</span> <span class="n">Table</span><span class="p">]</span>
  <span class="n">Localities</span> <span class="p">:</span> <span class="mi">0000000000000003</span>
<span class="n">Locality</span>   <span class="mi">0</span> <span class="p">:</span> <span class="mi">10</span> <span class="mi">20</span>
<span class="n">Locality</span>   <span class="mi">1</span> <span class="p">:</span> <span class="n">FF</span> <span class="mi">0</span><span class="n">A</span>
</pre></div>
</div>
<p>DSDT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Scope</span> <span class="p">(</span><span class="n">_SB</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Device</span> <span class="p">(</span><span class="n">S0D0</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="n">Name</span> <span class="p">(</span><span class="n">_HID</span><span class="p">,</span> <span class="s2">&quot;ACPI0016&quot;</span> <span class="o">/*</span> <span class="n">Compute</span> <span class="n">Express</span> <span class="n">Link</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="o">*/</span><span class="p">)</span>  <span class="o">//</span> <span class="n">_HID</span><span class="p">:</span> <span class="n">Hardware</span> <span class="n">ID</span>
      <span class="o">...</span>
      <span class="n">Name</span> <span class="p">(</span><span class="n">_UID</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">)</span>  <span class="o">//</span> <span class="n">_UID</span><span class="p">:</span> <span class="n">Unique</span> <span class="n">ID</span>
  <span class="p">}</span>
  <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<span id="document-platform/example-configurations/hb-interleave"></span><section id="cross-host-bridge-interleave">
<h3>Cross-Host-Bridge Interleave<a class="headerlink" href="#cross-host-bridge-interleave" title="Link to this heading"></a></h3>
<p>This system has a single socket with two CXL host bridges. Each host bridge
has a single CXL memory expander with a 4GB of memory.</p>
<p>Things to note:</p>
<ul class="simple">
<li><p>Cross-Bridge interleave is described.</p></li>
<li><p>The expanders are described by a single CFMWS.</p></li>
<li><p>This SRAT describes one-node for both host bridges.</p></li>
<li><p>The HMAT describes a single node’s performance.</p></li>
</ul>
<p>CEDT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">00</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="n">Structure</span><span class="p">]</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                  <span class="n">Length</span> <span class="p">:</span> <span class="mi">0020</span>
  <span class="n">Associated</span> <span class="n">host</span> <span class="n">bridge</span> <span class="p">:</span> <span class="mi">00000007</span>
   <span class="n">Specification</span> <span class="n">version</span> <span class="p">:</span> <span class="mi">00000001</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
           <span class="n">Register</span> <span class="n">base</span> <span class="p">:</span> <span class="mi">0000010370400000</span>
         <span class="n">Register</span> <span class="n">length</span> <span class="p">:</span> <span class="mi">0000000000010000</span>

           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">00</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="n">Structure</span><span class="p">]</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                  <span class="n">Length</span> <span class="p">:</span> <span class="mi">0020</span>
  <span class="n">Associated</span> <span class="n">host</span> <span class="n">bridge</span> <span class="p">:</span> <span class="mi">00000006</span>
   <span class="n">Specification</span> <span class="n">version</span> <span class="p">:</span> <span class="mi">00000001</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
           <span class="n">Register</span> <span class="n">base</span> <span class="p">:</span> <span class="mi">0000010380800000</span>
         <span class="n">Register</span> <span class="n">length</span> <span class="p">:</span> <span class="mi">0000000000010000</span>

           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Fixed</span> <span class="n">Memory</span> <span class="n">Window</span> <span class="n">Structure</span><span class="p">]</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                  <span class="n">Length</span> <span class="p">:</span> <span class="mi">002</span><span class="n">C</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
     <span class="n">Window</span> <span class="n">base</span> <span class="n">address</span> <span class="p">:</span> <span class="mi">0000001000000000</span>
             <span class="n">Window</span> <span class="n">size</span> <span class="p">:</span> <span class="mi">0000000200000000</span>
<span class="n">Interleave</span> <span class="n">Members</span> <span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="n">n</span><span class="p">)</span> <span class="p">:</span> <span class="mi">01</span>
   <span class="n">Interleave</span> <span class="n">Arithmetic</span> <span class="p">:</span> <span class="mi">00</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">0000</span>
             <span class="n">Granularity</span> <span class="p">:</span> <span class="mi">00000000</span>
            <span class="n">Restrictions</span> <span class="p">:</span> <span class="mi">0006</span>
                   <span class="n">QtgId</span> <span class="p">:</span> <span class="mi">0001</span>
            <span class="n">First</span> <span class="n">Target</span> <span class="p">:</span> <span class="mi">00000007</span>
           <span class="n">Second</span> <span class="n">Target</span> <span class="p">:</span> <span class="mi">00000006</span>
</pre></div>
</div>
<p>SRAT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">Memory</span> <span class="n">Affinity</span><span class="p">]</span>
               <span class="n">Length</span> <span class="p">:</span> <span class="mi">28</span>
     <span class="n">Proximity</span> <span class="n">Domain</span> <span class="p">:</span> <span class="mi">00000001</span>
            <span class="n">Reserved1</span> <span class="p">:</span> <span class="mi">0000</span>
         <span class="n">Base</span> <span class="n">Address</span> <span class="p">:</span> <span class="mi">0000001000000000</span>
       <span class="n">Address</span> <span class="n">Length</span> <span class="p">:</span> <span class="mi">0000000200000000</span>
            <span class="n">Reserved2</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Flags</span> <span class="p">(</span><span class="n">decoded</span> <span class="n">below</span><span class="p">)</span> <span class="p">:</span> <span class="mi">0000000</span><span class="n">B</span>
            <span class="n">Enabled</span> <span class="p">:</span> <span class="mi">1</span>
      <span class="n">Hot</span> <span class="n">Pluggable</span> <span class="p">:</span> <span class="mi">1</span>
       <span class="n">Non</span><span class="o">-</span><span class="n">Volatile</span> <span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>HMAT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>              <span class="n">Structure</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">0001</span> <span class="p">[</span><span class="n">SLLBI</span><span class="p">]</span>
                   <span class="n">Data</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">00</span>   <span class="p">[</span><span class="n">Latency</span><span class="p">]</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000001</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000002</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0080</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0100</span>

              <span class="n">Structure</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">0001</span> <span class="p">[</span><span class="n">SLLBI</span><span class="p">]</span>
                   <span class="n">Data</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">03</span>   <span class="p">[</span><span class="n">Bandwidth</span><span class="p">]</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000001</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000002</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">1200</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0400</span>
</pre></div>
</div>
<p>SLIT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">Signature</span> <span class="p">:</span> <span class="s2">&quot;SLIT&quot;</span>    <span class="p">[</span><span class="n">System</span> <span class="n">Locality</span> <span class="n">Information</span> <span class="n">Table</span><span class="p">]</span>
  <span class="n">Localities</span> <span class="p">:</span> <span class="mi">0000000000000003</span>
<span class="n">Locality</span>   <span class="mi">0</span> <span class="p">:</span> <span class="mi">10</span> <span class="mi">20</span>
<span class="n">Locality</span>   <span class="mi">1</span> <span class="p">:</span> <span class="n">FF</span> <span class="mi">0</span><span class="n">A</span>
</pre></div>
</div>
<p>DSDT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Scope</span> <span class="p">(</span><span class="n">_SB</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Device</span> <span class="p">(</span><span class="n">S0D0</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="n">Name</span> <span class="p">(</span><span class="n">_HID</span><span class="p">,</span> <span class="s2">&quot;ACPI0016&quot;</span> <span class="o">/*</span> <span class="n">Compute</span> <span class="n">Express</span> <span class="n">Link</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="o">*/</span><span class="p">)</span>  <span class="o">//</span> <span class="n">_HID</span><span class="p">:</span> <span class="n">Hardware</span> <span class="n">ID</span>
      <span class="o">...</span>
      <span class="n">Name</span> <span class="p">(</span><span class="n">_UID</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">)</span>  <span class="o">//</span> <span class="n">_UID</span><span class="p">:</span> <span class="n">Unique</span> <span class="n">ID</span>
  <span class="p">}</span>
  <span class="o">...</span>
  <span class="n">Device</span> <span class="p">(</span><span class="n">S0D5</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="n">Name</span> <span class="p">(</span><span class="n">_HID</span><span class="p">,</span> <span class="s2">&quot;ACPI0016&quot;</span> <span class="o">/*</span> <span class="n">Compute</span> <span class="n">Express</span> <span class="n">Link</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="o">*/</span><span class="p">)</span>  <span class="o">//</span> <span class="n">_HID</span><span class="p">:</span> <span class="n">Hardware</span> <span class="n">ID</span>
      <span class="o">...</span>
      <span class="n">Name</span> <span class="p">(</span><span class="n">_UID</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">)</span>  <span class="o">//</span> <span class="n">_UID</span><span class="p">:</span> <span class="n">Unique</span> <span class="n">ID</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<span id="document-platform/example-configurations/flexible"></span><section id="flexible-presentation">
<h3>Flexible Presentation<a class="headerlink" href="#flexible-presentation" title="Link to this heading"></a></h3>
<p>This system has a single socket with two CXL host bridges. Each host bridge
has two CXL memory expanders with a 4GB of memory (32GB total).</p>
<p>On this system, the platform designer wanted to provide the user flexibility
to configure the memory devices in various interleave or NUMA node
configurations.  So they provided every combination.</p>
<p>Things to note:</p>
<ul class="simple">
<li><p>Cross-Bridge interleave is described in one CFMWS that covers all capacity.</p></li>
<li><p>One CFMWS is also described per-host bridge.</p></li>
<li><p>One CFMWS is also described per-device.</p></li>
<li><p>This SRAT describes one-node for each of the above CFMWS.</p></li>
<li><p>The HMAT describes performance for each node in the SRAT.</p></li>
</ul>
<p>CEDT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">00</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="n">Structure</span><span class="p">]</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                  <span class="n">Length</span> <span class="p">:</span> <span class="mi">0020</span>
  <span class="n">Associated</span> <span class="n">host</span> <span class="n">bridge</span> <span class="p">:</span> <span class="mi">00000007</span>
   <span class="n">Specification</span> <span class="n">version</span> <span class="p">:</span> <span class="mi">00000001</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
           <span class="n">Register</span> <span class="n">base</span> <span class="p">:</span> <span class="mi">0000010370400000</span>
         <span class="n">Register</span> <span class="n">length</span> <span class="p">:</span> <span class="mi">0000000000010000</span>

           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">00</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="n">Structure</span><span class="p">]</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                  <span class="n">Length</span> <span class="p">:</span> <span class="mi">0020</span>
  <span class="n">Associated</span> <span class="n">host</span> <span class="n">bridge</span> <span class="p">:</span> <span class="mi">00000006</span>
   <span class="n">Specification</span> <span class="n">version</span> <span class="p">:</span> <span class="mi">00000001</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
           <span class="n">Register</span> <span class="n">base</span> <span class="p">:</span> <span class="mi">0000010380800000</span>
         <span class="n">Register</span> <span class="n">length</span> <span class="p">:</span> <span class="mi">0000000000010000</span>

           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Fixed</span> <span class="n">Memory</span> <span class="n">Window</span> <span class="n">Structure</span><span class="p">]</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                  <span class="n">Length</span> <span class="p">:</span> <span class="mi">002</span><span class="n">C</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
     <span class="n">Window</span> <span class="n">base</span> <span class="n">address</span> <span class="p">:</span> <span class="mi">0000001000000000</span>
             <span class="n">Window</span> <span class="n">size</span> <span class="p">:</span> <span class="mi">0000000400000000</span>
<span class="n">Interleave</span> <span class="n">Members</span> <span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="n">n</span><span class="p">)</span> <span class="p">:</span> <span class="mi">01</span>
   <span class="n">Interleave</span> <span class="n">Arithmetic</span> <span class="p">:</span> <span class="mi">00</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">0000</span>
             <span class="n">Granularity</span> <span class="p">:</span> <span class="mi">00000000</span>
            <span class="n">Restrictions</span> <span class="p">:</span> <span class="mi">0006</span>
                   <span class="n">QtgId</span> <span class="p">:</span> <span class="mi">0001</span>
            <span class="n">First</span> <span class="n">Target</span> <span class="p">:</span> <span class="mi">00000007</span>
           <span class="n">Second</span> <span class="n">Target</span> <span class="p">:</span> <span class="mi">00000006</span>

           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Fixed</span> <span class="n">Memory</span> <span class="n">Window</span> <span class="n">Structure</span><span class="p">]</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                  <span class="n">Length</span> <span class="p">:</span> <span class="mi">002</span><span class="n">C</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
     <span class="n">Window</span> <span class="n">base</span> <span class="n">address</span> <span class="p">:</span> <span class="mi">0000002000000000</span>
             <span class="n">Window</span> <span class="n">size</span> <span class="p">:</span> <span class="mi">0000000200000000</span>
<span class="n">Interleave</span> <span class="n">Members</span> <span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="n">n</span><span class="p">)</span> <span class="p">:</span> <span class="mi">00</span>
   <span class="n">Interleave</span> <span class="n">Arithmetic</span> <span class="p">:</span> <span class="mi">00</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">0000</span>
             <span class="n">Granularity</span> <span class="p">:</span> <span class="mi">00000000</span>
            <span class="n">Restrictions</span> <span class="p">:</span> <span class="mi">0006</span>
                   <span class="n">QtgId</span> <span class="p">:</span> <span class="mi">0001</span>
            <span class="n">First</span> <span class="n">Target</span> <span class="p">:</span> <span class="mi">00000007</span>

           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Fixed</span> <span class="n">Memory</span> <span class="n">Window</span> <span class="n">Structure</span><span class="p">]</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                  <span class="n">Length</span> <span class="p">:</span> <span class="mi">002</span><span class="n">C</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
     <span class="n">Window</span> <span class="n">base</span> <span class="n">address</span> <span class="p">:</span> <span class="mi">0000002200000000</span>
             <span class="n">Window</span> <span class="n">size</span> <span class="p">:</span> <span class="mi">0000000200000000</span>
<span class="n">Interleave</span> <span class="n">Members</span> <span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="n">n</span><span class="p">)</span> <span class="p">:</span> <span class="mi">00</span>
   <span class="n">Interleave</span> <span class="n">Arithmetic</span> <span class="p">:</span> <span class="mi">00</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">0000</span>
             <span class="n">Granularity</span> <span class="p">:</span> <span class="mi">00000000</span>
            <span class="n">Restrictions</span> <span class="p">:</span> <span class="mi">0006</span>
                   <span class="n">QtgId</span> <span class="p">:</span> <span class="mi">0001</span>
            <span class="n">First</span> <span class="n">Target</span> <span class="p">:</span> <span class="mi">00000006</span>

           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Fixed</span> <span class="n">Memory</span> <span class="n">Window</span> <span class="n">Structure</span><span class="p">]</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                  <span class="n">Length</span> <span class="p">:</span> <span class="mi">002</span><span class="n">C</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
     <span class="n">Window</span> <span class="n">base</span> <span class="n">address</span> <span class="p">:</span> <span class="mi">0000003000000000</span>
             <span class="n">Window</span> <span class="n">size</span> <span class="p">:</span> <span class="mi">0000000100000000</span>
<span class="n">Interleave</span> <span class="n">Members</span> <span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="n">n</span><span class="p">)</span> <span class="p">:</span> <span class="mi">00</span>
   <span class="n">Interleave</span> <span class="n">Arithmetic</span> <span class="p">:</span> <span class="mi">00</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">0000</span>
             <span class="n">Granularity</span> <span class="p">:</span> <span class="mi">00000000</span>
            <span class="n">Restrictions</span> <span class="p">:</span> <span class="mi">0006</span>
                   <span class="n">QtgId</span> <span class="p">:</span> <span class="mi">0001</span>
            <span class="n">First</span> <span class="n">Target</span> <span class="p">:</span> <span class="mi">00000007</span>

           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Fixed</span> <span class="n">Memory</span> <span class="n">Window</span> <span class="n">Structure</span><span class="p">]</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                  <span class="n">Length</span> <span class="p">:</span> <span class="mi">002</span><span class="n">C</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
     <span class="n">Window</span> <span class="n">base</span> <span class="n">address</span> <span class="p">:</span> <span class="mi">0000003100000000</span>
             <span class="n">Window</span> <span class="n">size</span> <span class="p">:</span> <span class="mi">0000000100000000</span>
<span class="n">Interleave</span> <span class="n">Members</span> <span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="n">n</span><span class="p">)</span> <span class="p">:</span> <span class="mi">00</span>
   <span class="n">Interleave</span> <span class="n">Arithmetic</span> <span class="p">:</span> <span class="mi">00</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">0000</span>
             <span class="n">Granularity</span> <span class="p">:</span> <span class="mi">00000000</span>
            <span class="n">Restrictions</span> <span class="p">:</span> <span class="mi">0006</span>
                   <span class="n">QtgId</span> <span class="p">:</span> <span class="mi">0001</span>
            <span class="n">First</span> <span class="n">Target</span> <span class="p">:</span> <span class="mi">00000007</span>

           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Fixed</span> <span class="n">Memory</span> <span class="n">Window</span> <span class="n">Structure</span><span class="p">]</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                  <span class="n">Length</span> <span class="p">:</span> <span class="mi">002</span><span class="n">C</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
     <span class="n">Window</span> <span class="n">base</span> <span class="n">address</span> <span class="p">:</span> <span class="mi">0000003200000000</span>
             <span class="n">Window</span> <span class="n">size</span> <span class="p">:</span> <span class="mi">0000000100000000</span>
<span class="n">Interleave</span> <span class="n">Members</span> <span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="n">n</span><span class="p">)</span> <span class="p">:</span> <span class="mi">00</span>
   <span class="n">Interleave</span> <span class="n">Arithmetic</span> <span class="p">:</span> <span class="mi">00</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">0000</span>
             <span class="n">Granularity</span> <span class="p">:</span> <span class="mi">00000000</span>
            <span class="n">Restrictions</span> <span class="p">:</span> <span class="mi">0006</span>
                   <span class="n">QtgId</span> <span class="p">:</span> <span class="mi">0001</span>
            <span class="n">First</span> <span class="n">Target</span> <span class="p">:</span> <span class="mi">00000006</span>

           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Fixed</span> <span class="n">Memory</span> <span class="n">Window</span> <span class="n">Structure</span><span class="p">]</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00</span>
                  <span class="n">Length</span> <span class="p">:</span> <span class="mi">002</span><span class="n">C</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">00000000</span>
     <span class="n">Window</span> <span class="n">base</span> <span class="n">address</span> <span class="p">:</span> <span class="mi">0000003300000000</span>
             <span class="n">Window</span> <span class="n">size</span> <span class="p">:</span> <span class="mi">0000000100000000</span>
<span class="n">Interleave</span> <span class="n">Members</span> <span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="n">n</span><span class="p">)</span> <span class="p">:</span> <span class="mi">00</span>
   <span class="n">Interleave</span> <span class="n">Arithmetic</span> <span class="p">:</span> <span class="mi">00</span>
                <span class="n">Reserved</span> <span class="p">:</span> <span class="mi">0000</span>
             <span class="n">Granularity</span> <span class="p">:</span> <span class="mi">00000000</span>
            <span class="n">Restrictions</span> <span class="p">:</span> <span class="mi">0006</span>
                   <span class="n">QtgId</span> <span class="p">:</span> <span class="mi">0001</span>
            <span class="n">First</span> <span class="n">Target</span> <span class="p">:</span> <span class="mi">00000006</span>
</pre></div>
</div>
<p>SRAT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">Memory</span> <span class="n">Affinity</span><span class="p">]</span>
               <span class="n">Length</span> <span class="p">:</span> <span class="mi">28</span>
     <span class="n">Proximity</span> <span class="n">Domain</span> <span class="p">:</span> <span class="mi">00000001</span>
            <span class="n">Reserved1</span> <span class="p">:</span> <span class="mi">0000</span>
         <span class="n">Base</span> <span class="n">Address</span> <span class="p">:</span> <span class="mi">0000001000000000</span>
       <span class="n">Address</span> <span class="n">Length</span> <span class="p">:</span> <span class="mi">0000000400000000</span>
            <span class="n">Reserved2</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Flags</span> <span class="p">(</span><span class="n">decoded</span> <span class="n">below</span><span class="p">)</span> <span class="p">:</span> <span class="mi">0000000</span><span class="n">B</span>
            <span class="n">Enabled</span> <span class="p">:</span> <span class="mi">1</span>
      <span class="n">Hot</span> <span class="n">Pluggable</span> <span class="p">:</span> <span class="mi">1</span>
       <span class="n">Non</span><span class="o">-</span><span class="n">Volatile</span> <span class="p">:</span> <span class="mi">0</span>

        <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">Memory</span> <span class="n">Affinity</span><span class="p">]</span>
               <span class="n">Length</span> <span class="p">:</span> <span class="mi">28</span>
     <span class="n">Proximity</span> <span class="n">Domain</span> <span class="p">:</span> <span class="mi">00000002</span>
            <span class="n">Reserved1</span> <span class="p">:</span> <span class="mi">0000</span>
         <span class="n">Base</span> <span class="n">Address</span> <span class="p">:</span> <span class="mi">0000002000000000</span>
       <span class="n">Address</span> <span class="n">Length</span> <span class="p">:</span> <span class="mi">0000000200000000</span>
            <span class="n">Reserved2</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Flags</span> <span class="p">(</span><span class="n">decoded</span> <span class="n">below</span><span class="p">)</span> <span class="p">:</span> <span class="mi">0000000</span><span class="n">B</span>
            <span class="n">Enabled</span> <span class="p">:</span> <span class="mi">1</span>
      <span class="n">Hot</span> <span class="n">Pluggable</span> <span class="p">:</span> <span class="mi">1</span>
       <span class="n">Non</span><span class="o">-</span><span class="n">Volatile</span> <span class="p">:</span> <span class="mi">0</span>

        <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">Memory</span> <span class="n">Affinity</span><span class="p">]</span>
               <span class="n">Length</span> <span class="p">:</span> <span class="mi">28</span>
     <span class="n">Proximity</span> <span class="n">Domain</span> <span class="p">:</span> <span class="mi">00000003</span>
            <span class="n">Reserved1</span> <span class="p">:</span> <span class="mi">0000</span>
         <span class="n">Base</span> <span class="n">Address</span> <span class="p">:</span> <span class="mi">0000002200000000</span>
       <span class="n">Address</span> <span class="n">Length</span> <span class="p">:</span> <span class="mi">0000000200000000</span>
            <span class="n">Reserved2</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Flags</span> <span class="p">(</span><span class="n">decoded</span> <span class="n">below</span><span class="p">)</span> <span class="p">:</span> <span class="mi">0000000</span><span class="n">B</span>
            <span class="n">Enabled</span> <span class="p">:</span> <span class="mi">1</span>
      <span class="n">Hot</span> <span class="n">Pluggable</span> <span class="p">:</span> <span class="mi">1</span>
       <span class="n">Non</span><span class="o">-</span><span class="n">Volatile</span> <span class="p">:</span> <span class="mi">0</span>

        <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">Memory</span> <span class="n">Affinity</span><span class="p">]</span>
               <span class="n">Length</span> <span class="p">:</span> <span class="mi">28</span>
     <span class="n">Proximity</span> <span class="n">Domain</span> <span class="p">:</span> <span class="mi">00000004</span>
            <span class="n">Reserved1</span> <span class="p">:</span> <span class="mi">0000</span>
         <span class="n">Base</span> <span class="n">Address</span> <span class="p">:</span> <span class="mi">0000003000000000</span>
       <span class="n">Address</span> <span class="n">Length</span> <span class="p">:</span> <span class="mi">0000000100000000</span>
            <span class="n">Reserved2</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Flags</span> <span class="p">(</span><span class="n">decoded</span> <span class="n">below</span><span class="p">)</span> <span class="p">:</span> <span class="mi">0000000</span><span class="n">B</span>
            <span class="n">Enabled</span> <span class="p">:</span> <span class="mi">1</span>
      <span class="n">Hot</span> <span class="n">Pluggable</span> <span class="p">:</span> <span class="mi">1</span>
       <span class="n">Non</span><span class="o">-</span><span class="n">Volatile</span> <span class="p">:</span> <span class="mi">0</span>

        <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">Memory</span> <span class="n">Affinity</span><span class="p">]</span>
               <span class="n">Length</span> <span class="p">:</span> <span class="mi">28</span>
     <span class="n">Proximity</span> <span class="n">Domain</span> <span class="p">:</span> <span class="mi">00000005</span>
            <span class="n">Reserved1</span> <span class="p">:</span> <span class="mi">0000</span>
         <span class="n">Base</span> <span class="n">Address</span> <span class="p">:</span> <span class="mi">0000003100000000</span>
       <span class="n">Address</span> <span class="n">Length</span> <span class="p">:</span> <span class="mi">0000000100000000</span>
            <span class="n">Reserved2</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Flags</span> <span class="p">(</span><span class="n">decoded</span> <span class="n">below</span><span class="p">)</span> <span class="p">:</span> <span class="mi">0000000</span><span class="n">B</span>
            <span class="n">Enabled</span> <span class="p">:</span> <span class="mi">1</span>
      <span class="n">Hot</span> <span class="n">Pluggable</span> <span class="p">:</span> <span class="mi">1</span>
       <span class="n">Non</span><span class="o">-</span><span class="n">Volatile</span> <span class="p">:</span> <span class="mi">0</span>

        <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">Memory</span> <span class="n">Affinity</span><span class="p">]</span>
               <span class="n">Length</span> <span class="p">:</span> <span class="mi">28</span>
     <span class="n">Proximity</span> <span class="n">Domain</span> <span class="p">:</span> <span class="mi">00000006</span>
            <span class="n">Reserved1</span> <span class="p">:</span> <span class="mi">0000</span>
         <span class="n">Base</span> <span class="n">Address</span> <span class="p">:</span> <span class="mi">0000003200000000</span>
       <span class="n">Address</span> <span class="n">Length</span> <span class="p">:</span> <span class="mi">0000000100000000</span>
            <span class="n">Reserved2</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Flags</span> <span class="p">(</span><span class="n">decoded</span> <span class="n">below</span><span class="p">)</span> <span class="p">:</span> <span class="mi">0000000</span><span class="n">B</span>
            <span class="n">Enabled</span> <span class="p">:</span> <span class="mi">1</span>
      <span class="n">Hot</span> <span class="n">Pluggable</span> <span class="p">:</span> <span class="mi">1</span>
       <span class="n">Non</span><span class="o">-</span><span class="n">Volatile</span> <span class="p">:</span> <span class="mi">0</span>

        <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">Memory</span> <span class="n">Affinity</span><span class="p">]</span>
               <span class="n">Length</span> <span class="p">:</span> <span class="mi">28</span>
     <span class="n">Proximity</span> <span class="n">Domain</span> <span class="p">:</span> <span class="mi">00000007</span>
            <span class="n">Reserved1</span> <span class="p">:</span> <span class="mi">0000</span>
         <span class="n">Base</span> <span class="n">Address</span> <span class="p">:</span> <span class="mi">0000003300000000</span>
       <span class="n">Address</span> <span class="n">Length</span> <span class="p">:</span> <span class="mi">0000000100000000</span>
            <span class="n">Reserved2</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Flags</span> <span class="p">(</span><span class="n">decoded</span> <span class="n">below</span><span class="p">)</span> <span class="p">:</span> <span class="mi">0000000</span><span class="n">B</span>
            <span class="n">Enabled</span> <span class="p">:</span> <span class="mi">1</span>
      <span class="n">Hot</span> <span class="n">Pluggable</span> <span class="p">:</span> <span class="mi">1</span>
       <span class="n">Non</span><span class="o">-</span><span class="n">Volatile</span> <span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>HMAT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>              <span class="n">Structure</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">0001</span> <span class="p">[</span><span class="n">SLLBI</span><span class="p">]</span>
                   <span class="n">Data</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">00</span>   <span class="p">[</span><span class="n">Latency</span><span class="p">]</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000001</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000002</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000003</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000004</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000005</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000006</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000007</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0080</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0100</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0100</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0100</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0100</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0100</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0100</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0100</span>

              <span class="n">Structure</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">0001</span> <span class="p">[</span><span class="n">SLLBI</span><span class="p">]</span>
                   <span class="n">Data</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">03</span>   <span class="p">[</span><span class="n">Bandwidth</span><span class="p">]</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000000</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000001</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000002</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000003</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000004</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000005</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000006</span>
<span class="n">Target</span> <span class="n">Proximity</span> <span class="n">Domain</span> <span class="n">List</span> <span class="p">:</span> <span class="mi">00000007</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">1200</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0400</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0200</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0200</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0100</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0100</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0100</span>
                       <span class="n">Entry</span> <span class="p">:</span> <span class="mi">0100</span>
</pre></div>
</div>
<p>SLIT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">Signature</span> <span class="p">:</span> <span class="s2">&quot;SLIT&quot;</span>    <span class="p">[</span><span class="n">System</span> <span class="n">Locality</span> <span class="n">Information</span> <span class="n">Table</span><span class="p">]</span>
  <span class="n">Localities</span> <span class="p">:</span> <span class="mi">0000000000000003</span>
<span class="n">Locality</span>   <span class="mi">0</span> <span class="p">:</span> <span class="mi">10</span> <span class="mi">20</span> <span class="mi">20</span> <span class="mi">20</span> <span class="mi">20</span> <span class="mi">20</span> <span class="mi">20</span> <span class="mi">20</span>
<span class="n">Locality</span>   <span class="mi">1</span> <span class="p">:</span> <span class="n">FF</span> <span class="mi">0</span><span class="n">A</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span>
<span class="n">Locality</span>   <span class="mi">2</span> <span class="p">:</span> <span class="n">FF</span> <span class="n">FF</span> <span class="mi">0</span><span class="n">A</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span>
<span class="n">Locality</span>   <span class="mi">3</span> <span class="p">:</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="mi">0</span><span class="n">A</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span>
<span class="n">Locality</span>   <span class="mi">4</span> <span class="p">:</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="mi">0</span><span class="n">A</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span>
<span class="n">Locality</span>   <span class="mi">5</span> <span class="p">:</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="mi">0</span><span class="n">A</span> <span class="n">FF</span> <span class="n">FF</span>
<span class="n">Locality</span>   <span class="mi">6</span> <span class="p">:</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="mi">0</span><span class="n">A</span> <span class="n">FF</span>
<span class="n">Locality</span>   <span class="mi">7</span> <span class="p">:</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="n">FF</span> <span class="mi">0</span><span class="n">A</span>
</pre></div>
</div>
<p>DSDT</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Scope</span> <span class="p">(</span><span class="n">_SB</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Device</span> <span class="p">(</span><span class="n">S0D0</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="n">Name</span> <span class="p">(</span><span class="n">_HID</span><span class="p">,</span> <span class="s2">&quot;ACPI0016&quot;</span> <span class="o">/*</span> <span class="n">Compute</span> <span class="n">Express</span> <span class="n">Link</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="o">*/</span><span class="p">)</span>  <span class="o">//</span> <span class="n">_HID</span><span class="p">:</span> <span class="n">Hardware</span> <span class="n">ID</span>
      <span class="o">...</span>
      <span class="n">Name</span> <span class="p">(</span><span class="n">_UID</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">)</span>  <span class="o">//</span> <span class="n">_UID</span><span class="p">:</span> <span class="n">Unique</span> <span class="n">ID</span>
  <span class="p">}</span>
  <span class="o">...</span>
  <span class="n">Device</span> <span class="p">(</span><span class="n">S0D5</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="n">Name</span> <span class="p">(</span><span class="n">_HID</span><span class="p">,</span> <span class="s2">&quot;ACPI0016&quot;</span> <span class="o">/*</span> <span class="n">Compute</span> <span class="n">Express</span> <span class="n">Link</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="o">*/</span><span class="p">)</span>  <span class="o">//</span> <span class="n">_HID</span><span class="p">:</span> <span class="n">Hardware</span> <span class="n">ID</span>
      <span class="o">...</span>
      <span class="n">Name</span> <span class="p">(</span><span class="n">_UID</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">)</span>  <span class="o">//</span> <span class="n">_UID</span><span class="p">:</span> <span class="n">Unique</span> <span class="n">ID</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</div>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-linux/overview"></span><section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>This section presents the configuration process of a CXL Type-3 memory device,
and how it is ultimately exposed to users as either a <code class="code docutils literal notranslate"><span class="pre">DAX</span></code> device or
normal memory pages via the kernel’s page allocator.</p>
<p>Portions marked with a bullet are points at which certain kernel objects
are generated.</p>
<ol class="arabic simple">
<li><p>Early Boot</p></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>BIOS, Build, and Boot Parameters</p></li>
</ol>
<blockquote>
<div><ol class="lowerroman simple">
<li><p>EFI_MEMORY_SP</p></li>
<li><p>CONFIG_EFI_SOFT_RESERVE</p></li>
<li><p>CONFIG_MHP_DEFAULT_ONLINE_TYPE</p></li>
<li><p>nosoftreserve</p></li>
</ol>
</div></blockquote>
<ol class="loweralpha simple" start="2">
<li><p>Memory Map Creation</p></li>
</ol>
<blockquote>
<div><ol class="lowerroman simple">
<li><p>EFI Memory Map / E820 Consulted for Soft-Reserved</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>CXL Memory is set aside to be handled by the CXL driver</p></li>
<li><p>IO Resources are created for CFMWS entry</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<ol class="loweralpha simple" start="3">
<li><p>NUMA Node Creation</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>ACPI CEDT and SRAT table are used to create Nodes from Proximity domains (PXM)</p></li>
</ul>
</div></blockquote>
<ol class="loweralpha simple" start="4">
<li><p>Memory Tier Creation</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>A default memory_tier is created with all nodes.</p></li>
</ul>
</div></blockquote>
<ol class="loweralpha simple" start="5">
<li><p>Contiguous Memory Allocation</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Any requested CMA is allocated from Online nodes</p></li>
</ul>
</div></blockquote>
<ol class="loweralpha simple" start="6">
<li><p>Init Finishes, Drivers start probing</p></li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>ACPI and PCI Drivers</p></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Detect CXL device, marking it for probe by CXL driver</p></li>
<li><p>This portion will not be covered specifically.</p></li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>CXL Driver Operation</p></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Base device creation</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>root, port, and memdev devices created</p></li>
<li><p>CEDT CFMWS IO Resource creation</p></li>
</ul>
</div></blockquote>
<ol class="loweralpha simple" start="2">
<li><p>Decoder creation</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>root, switch, and endpoint decoders created</p></li>
</ul>
</div></blockquote>
<ol class="loweralpha simple" start="3">
<li><p>Logical device creation</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>memory_region and endpoint devices created</p></li>
</ul>
</div></blockquote>
<ol class="loweralpha simple" start="4">
<li><p>Devices are associated with each other</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>If auto-decoder (BIOS-programmed decoders), driver validates
configurations, builds associations, and locks configs at probe time.</p></li>
<li><p>If user-configured, validation and associations are built at
decoder-commit time.</p></li>
</ul>
</div></blockquote>
<ol class="loweralpha simple" start="5">
<li><p>Regions surfaced as DAX region</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>dax_region created</p></li>
<li><p>DAX device created via DAX driver</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>DAX Driver Operation</p></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>DAX driver surfaces DAX region as one of two dax device modes</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>kmem - dax device is converted to hotplug memory blocks</p>
<ul>
<li><p>DAX kmem IO resource creation</p></li>
</ul>
</li>
<li><p>hmem - dax device is left as daxdev to be accessed as a file.</p>
<ul>
<li><p>If hmem, journey ends here.</p></li>
</ul>
</li>
</ul>
</div></blockquote>
<ol class="loweralpha simple" start="2">
<li><p>DAX kmem surfaces memory region to Memory Hotplug to add to page
allocator as “driver managed memory”</p></li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>Memory Hotplug</p></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>mhp component surfaces a dax device memory region as multiple memory
blocks to the page allocator</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>blocks appear in <code class="code docutils literal notranslate"><span class="pre">/sys/bus/memory/devices</span></code> and linked to a NUMA node</p></li>
</ul>
</div></blockquote>
<ol class="loweralpha simple" start="2">
<li><p>blocks are onlined into the requested zone (NORMAL or MOVABLE)</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Memory is marked “Driver Managed” to avoid kexec from using it as region
for kernel updates</p></li>
</ul>
</div></blockquote>
</div></blockquote>
</section>
<span id="document-linux/early-boot"></span><section id="linux-init-early-boot">
<h2>Linux Init (Early Boot)<a class="headerlink" href="#linux-init-early-boot" title="Link to this heading"></a></h2>
<p>Linux configuration is split into two major steps: Early-Boot and everything else.</p>
<p>During early boot, Linux sets up immutible resources (such as numa nodes), while
later operations include things like driver probe and memory hotplug.  Linux may
read EFI and ACPI information throughout this process to configure logical
representations of the devices.</p>
<p>During Linux Early Boot stage (functions in the kernel that have the __init
decorator), the system takes the resources created by EFI/BIOS (ACPI tables)
and turns them into resources that the kernel can consume.</p>
<section id="bios-build-and-boot-options">
<h3>BIOS, Build and Boot Options<a class="headerlink" href="#bios-build-and-boot-options" title="Link to this heading"></a></h3>
<p>There are 4 pre-boot options that need to be considered during kernel build
which dictate how memory will be managed by Linux during early boot.</p>
<ul class="simple">
<li><p>EFI_MEMORY_SP</p>
<ul>
<li><p>BIOS/EFI Option that dictates whether memory is SystemRAM or
Specific Purpose.  Specific Purpose memory will be deferred to
drivers to manage - and not immediately exposed as system RAM.</p></li>
</ul>
</li>
<li><p>CONFIG_EFI_SOFT_RESERVE</p>
<ul>
<li><p>Linux Build config option that dictates whether the kernel supports
Specific Purpose memory.</p></li>
</ul>
</li>
<li><p>CONFIG_MHP_DEFAULT_ONLINE_TYPE</p>
<ul>
<li><p>Linux Build config that dictates whether and how Specific Purpose memory
converted to a dax device should be managed (left as DAX or onlined as
SystemRAM in ZONE_NORMAL or ZONE_MOVABLE).</p></li>
</ul>
</li>
<li><p>nosoftreserve</p>
<ul>
<li><p>Linux kernel boot option that dictates whether Soft Reserve should be
supported.  Similar to CONFIG_EFI_SOFT_RESERVE.</p></li>
</ul>
</li>
</ul>
</section>
<section id="memory-map-creation">
<h3>Memory Map Creation<a class="headerlink" href="#memory-map-creation" title="Link to this heading"></a></h3>
<p>While the kernel parses the EFI memory map, if <code class="code docutils literal notranslate"><span class="pre">Specific</span> <span class="pre">Purpose</span></code> memory
is supported and detect, it will set this region aside as <code class="code docutils literal notranslate"><span class="pre">SOFT_RESERVED</span></code>.</p>
<p>If <code class="code docutils literal notranslate"><span class="pre">EFI_MEMORY_SP=0</span></code>, <code class="code docutils literal notranslate"><span class="pre">CONFIG_EFI_SOFT_RESERVE=n</span></code>, or
<code class="code docutils literal notranslate"><span class="pre">nosoftreserve=y</span></code> - Linux will default a CXL device memory region to
SystemRAM.  This will expose the memory to the kernel page allocator in
<code class="code docutils literal notranslate"><span class="pre">ZONE_NORMAL</span></code>, making it available for use for most allocations (including
<code class="code docutils literal notranslate"><span class="pre">struct</span> <span class="pre">page</span></code> and page tables).</p>
<p>If <cite>Specific Purpose</cite> is set and supported, <code class="code docutils literal notranslate"><span class="pre">CONFIG_MHP_DEFAULT_ONLINE_TYPE_*</span></code>
dictates whether the memory is onlined by default (<code class="code docutils literal notranslate"><span class="pre">_OFFLINE</span></code> or
<code class="code docutils literal notranslate"><span class="pre">_ONLINE_*</span></code>), and if online which zone to online this memory to by default
(<code class="code docutils literal notranslate"><span class="pre">_NORMAL</span></code> or <code class="code docutils literal notranslate"><span class="pre">_MOVABLE</span></code>).</p>
<p>If placed in <code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code>, the memory will not be available for most
kernel allocations (such as <code class="code docutils literal notranslate"><span class="pre">struct</span> <span class="pre">page</span></code> or page tables).  This may
significant impact performance depending on the memory capacity of the system.</p>
</section>
<section id="numa-node-reservation">
<h3>NUMA Node Reservation<a class="headerlink" href="#numa-node-reservation" title="Link to this heading"></a></h3>
<p>Linux refers to the proximity domains (<code class="code docutils literal notranslate"><span class="pre">PXM</span></code>) defined in the SRAT to
create NUMA nodes in <code class="code docutils literal notranslate"><span class="pre">acpi_numa_init</span></code>. Typically, there is a 1:1 relation
between <code class="code docutils literal notranslate"><span class="pre">PXM</span></code> and NUMA node IDs.</p>
<p>SRAT is the only ACPI defined way of defining Proximity Domains. Linux chooses
to, at most, map those 1:1 with NUMA nodes. CEDT adds a description of SPA
ranges which Linux may wish to map to one or more NUMA nodes</p>
<p>If there are CXL ranges in the CFMWS but not in SRAT, then a fake <code class="code docutils literal notranslate"><span class="pre">PXM</span></code>
is created (as of v6.15). In the future, Linux may reject CFMWS not described
by SRAT due to the ambiguity of proximity domain association.</p>
<p>It is important to note that NUMA node creation cannot be done at runtime. All
possible NUMA nodes are identified at <code class="code docutils literal notranslate"><span class="pre">__init</span></code> time, more specifically
during <code class="code docutils literal notranslate"><span class="pre">mm_init</span></code>. The CEDT and SRAT must contain sufficient <code class="code docutils literal notranslate"><span class="pre">PXM</span></code>
data for Linux to identify NUMA nodes their associated memory regions.</p>
<p>The relevant code exists in: <code class="code docutils literal notranslate"><span class="pre">linux/drivers/acpi/numa/srat.c</span></code>.</p>
<p>See the Example Platform Configurations section for more information.</p>
</section>
<section id="memory-tiers-creation">
<h3>Memory Tiers Creation<a class="headerlink" href="#memory-tiers-creation" title="Link to this heading"></a></h3>
<p>Memory tiers are a collection of NUMA nodes grouped by performance characteristics.
During <code class="code docutils literal notranslate"><span class="pre">__init</span></code>, Linux initializes the system with a default memory tier that
contains all nodes marked <code class="code docutils literal notranslate"><span class="pre">N_MEMORY</span></code>.</p>
<p><code class="code docutils literal notranslate"><span class="pre">memory_tier_init</span></code> is called at boot for all nodes with memory online by
default. <code class="code docutils literal notranslate"><span class="pre">memory_tier_late_init</span></code> is called during late-init for nodes setup
during driver configuration.</p>
<p>Nodes are only marked <code class="code docutils literal notranslate"><span class="pre">N_MEMORY</span></code> if they have <em>online</em> memory.</p>
<p>Tier membership can be inspected in</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">devices</span><span class="o">/</span><span class="n">virtual</span><span class="o">/</span><span class="n">memory_tiering</span><span class="o">/</span><span class="n">memory_tierN</span><span class="o">/</span><span class="n">nodelist</span>
<span class="mi">0</span><span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p>If nodes are grouped which have clear difference in performance, check the HMAT
and CDAT information for the CXL nodes.  All nodes default to the DRAM tier,
unless HMAT/CDAT information is reported to the memory_tier component via
<cite>access_coordinates</cite>.</p>
</section>
<section id="contiguous-memory-allocation">
<h3>Contiguous Memory Allocation<a class="headerlink" href="#contiguous-memory-allocation" title="Link to this heading"></a></h3>
<p>The contiguous memory allocator (CMA) enables reservation of contiguous memory
regions on NUMA nodes during early boot.  However, CMA cannot reserve memory
on NUMA nodes that are not online during early boot.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>void __init hugetlb_cma_reserve(int order) {
  if (!node_online(nid))
    /* do not allow reservations */
}
</pre></div>
</div>
<p>This means if users intend to defer management of CXL memory to the driver, CMA
cannot be used to guarantee huge page allocations.  If enabling CXL memory as
SystemRAM in <cite>ZONE_NORMAL</cite> during early boot, CMA reservations per-node can be
made with the <code class="code docutils literal notranslate"><span class="pre">cma_pernuma</span></code> or <code class="code docutils literal notranslate"><span class="pre">numa_cma</span></code> kernel command line
parameters.</p>
</section>
</section>
<span id="document-linux/cxl-driver"></span><section id="cxl-driver-operation">
<h2>CXL Driver Operation<a class="headerlink" href="#cxl-driver-operation" title="Link to this heading"></a></h2>
<p>The devices described in this section are present in</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">bus</span><span class="o">/</span><span class="n">cxl</span><span class="o">/</span><span class="n">devices</span><span class="o">/</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">cxl</span><span class="o">/</span>
</pre></div>
</div>
<p>The <code class="code docutils literal notranslate"><span class="pre">cxl-cli</span></code> library, maintained as part of the NDTCL project, may
be used to script interactions with these devices.</p>
<div class="toctree-wrapper compound">
<span id="document-linux/cxl-cli"></span><section id="cxl-cli-reference">
<h3>CXL-CLI Reference<a class="headerlink" href="#cxl-cli-reference" title="Link to this heading"></a></h3>
<p>todo</p>
</section>
</div>
<section id="drivers">
<h3>Drivers<a class="headerlink" href="#drivers" title="Link to this heading"></a></h3>
<p>The CXL driver is split into a number of drivers.</p>
<ul class="simple">
<li><p>cxl_core  - fundamental init interface and core object creation</p></li>
<li><p>cxl_port  - initializes root and provides port enumeration interface.</p></li>
<li><p>cxl_acpi  - initializes root decoders and interacts with ACPI data.</p></li>
<li><p>cxl_p/mem - initializes memory devices</p></li>
<li><p>cxl_pci   - uses cxl_port to enumates the actual fabric hierarchy.</p></li>
</ul>
</section>
<section id="driver-devices">
<h3>Driver Devices<a class="headerlink" href="#driver-devices" title="Link to this heading"></a></h3>
<p>Here is an example from a single-socket system with 4 host bridges. Two host
bridges have a single memory device attached, and the devices are interleaved
into a single memory region. The memory region has been converted to dax.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ls /sys/bus/cxl/devices/</span>
  <span class="n">dax_region0</span>  <span class="n">decoder3</span><span class="mf">.0</span>  <span class="n">decoder6</span><span class="mf">.0</span>  <span class="n">mem0</span>   <span class="n">port3</span>
  <span class="n">decoder0</span><span class="mf">.0</span>   <span class="n">decoder4</span><span class="mf">.0</span>  <span class="n">decoder6</span><span class="mf">.1</span>  <span class="n">mem1</span>   <span class="n">port4</span>
  <span class="n">decoder1</span><span class="mf">.0</span>   <span class="n">decoder5</span><span class="mf">.0</span>  <span class="n">endpoint5</span>   <span class="n">port1</span>  <span class="n">region0</span>
  <span class="n">decoder2</span><span class="mf">.0</span>   <span class="n">decoder5</span><span class="mf">.1</span>  <span class="n">endpoint6</span>   <span class="n">port2</span>  <span class="n">root0</span>
</pre></div>
</div>
<p>For this section we’ll explore the devices present in this configuration, but
we’ll explore more configurations in-depth in example configurations below.</p>
<section id="base-devices">
<h4>Base Devices<a class="headerlink" href="#base-devices" title="Link to this heading"></a></h4>
<p>Most devices in a CXL fabric are a <cite>port</cite> of some kind (because each
device mostly routes request from one device to the next, rather than
provide a manageable service).</p>
<section id="root">
<h5>Root<a class="headerlink" href="#root" title="Link to this heading"></a></h5>
<p>The <cite>CXL Root</cite> is logical object created by the <cite>cxl_acpi</cite> driver during
<code class="code docutils literal notranslate"><span class="pre">cxl_acpi_probe</span></code> - if the <code class="code docutils literal notranslate"><span class="pre">ACPI0017</span></code> <cite>Compute Express Link
Root Object</cite> Device Class is found.</p>
<p>The Root contains links to:</p>
<ul class="simple">
<li><p><cite>Host Bridge Ports</cite> defined by ACPI CEDT CHBS.</p></li>
<li><p><cite>Root Decoders</cite> defined by ACPI CEDT CFMWS.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ls /sys/bus/cxl/devices/root0</span>
  <span class="n">decoder0</span><span class="mf">.0</span>          <span class="n">dport0</span>  <span class="n">dport5</span>    <span class="n">port2</span>  <span class="n">subsystem</span>
  <span class="n">decoders_committed</span>  <span class="n">dport1</span>  <span class="n">modalias</span>  <span class="n">port3</span>  <span class="n">uevent</span>
  <span class="n">devtype</span>             <span class="n">dport4</span>  <span class="n">port1</span>     <span class="n">port4</span>  <span class="n">uport</span>

<span class="c1"># cat /sys/bus/cxl/devices/root0/devtype</span>
  <span class="n">cxl_port</span>

<span class="c1"># cat port1/devtype</span>
  <span class="n">cxl_port</span>

<span class="c1"># cat decoder0.0/devtype</span>
  <span class="n">cxl_decoder_root</span>
</pre></div>
</div>
<p>The root is first <cite>logical port</cite> in the CXL fabric, as presented by the Linux
CXL driver.  The <cite>CXL root</cite> is a special type of <cite>switch port</cite>, in that it
only has downstream port connections.</p>
</section>
<section id="port">
<h5>Port<a class="headerlink" href="#port" title="Link to this heading"></a></h5>
<p>A <cite>port</cite> object is better described as a <cite>switch port</cite>.  It may represent a
host bridge to the root or an actual switch port on a switch. A <cite>switch port</cite>
contains one or more decoders used to route memory requests downstream ports,
which may be connected to another <cite>switch port</cite> or an <cite>endpoint port</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ls /sys/bus/cxl/devices/port1</span>
  <span class="n">decoder1</span><span class="mf">.0</span>          <span class="n">dport0</span>    <span class="n">driver</span>     <span class="n">parent_dport</span>  <span class="n">uport</span>
  <span class="n">decoders_committed</span>  <span class="n">dport113</span>  <span class="n">endpoint5</span>  <span class="n">subsystem</span>
  <span class="n">devtype</span>             <span class="n">dport2</span>    <span class="n">modalias</span>   <span class="n">uevent</span>

<span class="c1"># cat devtype</span>
  <span class="n">cxl_port</span>

<span class="c1"># cat decoder1.0/devtype</span>
  <span class="n">cxl_decoder_switch</span>

<span class="c1"># cat endpoint5/devtype</span>
  <span class="n">cxl_port</span>
</pre></div>
</div>
<p>CXL <cite>Host Bridges</cite> in the fabric are probed during <code class="code docutils literal notranslate"><span class="pre">cxl_acpi_probe</span></code> at
the time the <cite>CXL Root</cite> is probed.  The allows for the immediate logical
connection to between between the root and host bridge.</p>
<ul class="simple">
<li><p>The root has a downstream port connection to a host bridge</p></li>
<li><p>The host bridge has an upstream port connection to the root.</p></li>
<li><p>The host bridge has one or more downstream port connections to switch
or endpoint ports.</p></li>
</ul>
<p>A <cite>Host Bridge</cite> is a special type of CXL <cite>switch port</cite>. It is explicitly
defined in the ACPI specification via <cite>ACPI0016</cite> ID.  <cite>Host Bridge</cite> ports
will be probed at <cite>acpi_probe</cite> time, while similar ports on an actual switch
will be probed later.  Otherwise, switch and host bridge ports look very
similar - the both contain switch decoders which route accesses between
upstream and downstream ports.</p>
</section>
<section id="endpoint">
<h5>Endpoint<a class="headerlink" href="#endpoint" title="Link to this heading"></a></h5>
<p>An <cite>endpoint</cite> is a terminal port in the fabric.  This is a <cite>logical device</cite>,
and may be one of many <cite>logical devices</cite> presented by a memory device. It
is still considered a type of <cite>port</cite> in the fabric.</p>
<p>An <cite>endpoint</cite> contains <cite>endpoint decoders</cite> available for use and the
<em>Coherent Device Attribute Table</em> (CDAT) used to describe the capabilities
of the device.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ls /sys/bus/cxl/devices/endpoint5</span>
  <span class="n">CDAT</span>        <span class="n">decoders_committed</span>  <span class="n">modalias</span>      <span class="n">uevent</span>
  <span class="n">decoder5</span><span class="mf">.0</span>  <span class="n">devtype</span>             <span class="n">parent_dport</span>  <span class="n">uport</span>
  <span class="n">decoder5</span><span class="mf">.1</span>  <span class="n">driver</span>              <span class="n">subsystem</span>

<span class="c1"># cat /sys/bus/cxl/devices/endpoint5/devtype</span>
  <span class="n">cxl_port</span>

<span class="c1"># cat /sys/bus/cxl/devices/endpoint5/decoder5.0/devtype</span>
  <span class="n">cxl_decoder_endpoint</span>
</pre></div>
</div>
</section>
<section id="memory-device-memdev">
<h5>Memory Device (memdev)<a class="headerlink" href="#memory-device-memdev" title="Link to this heading"></a></h5>
<p>A <cite>memdev</cite> is probed and added by the <cite>cxl_pci</cite> driver in <code class="code docutils literal notranslate"><span class="pre">cxl_pci_probe</span></code>
and is managed by the <cite>cxl_mem</cite> driver. It primarily provides the <cite>IOCTL</cite>
interface to a memory device, via <code class="code docutils literal notranslate"><span class="pre">/dev/cxl/memN</span></code>, and exposes various
device configuration data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ls /sys/bus/cxl/devices/mem0</span>
  <span class="n">dev</span>       <span class="n">firmware_version</span>    <span class="n">payload_max</span>  <span class="n">security</span>   <span class="n">uevent</span>
  <span class="n">driver</span>    <span class="n">label_storage_size</span>  <span class="n">pmem</span>         <span class="n">serial</span>
  <span class="n">firmware</span>  <span class="n">numa_node</span>           <span class="n">ram</span>          <span class="n">subsystem</span>
</pre></div>
</div>
</section>
</section>
<section id="decoders">
<h4>Decoders<a class="headerlink" href="#decoders" title="Link to this heading"></a></h4>
<p>A <cite>Decoder</cite> is short for a CXL Host-Managed Device Memory (HDM) Decoder. It is
a device that routes accesses through the CXL fabric to an endpoint, and at
the endpoint translates a <cite>Host Physical</cite> to <cite>Device Physical</cite> Addressing.</p>
<p>The CXL 3.1 specification heavily implies that only endpoint decoders should
engage in translation of <cite>Host Physical Address</cite> to <cite>Device Physical Address</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">8.2.4.20</span> <span class="n">CXL</span> <span class="n">HDM</span> <span class="n">Decoder</span> <span class="n">Capability</span> <span class="n">Structure</span>

<span class="n">IMPLEMENTATION</span> <span class="n">NOTE</span>
<span class="n">CXL</span> <span class="n">Host</span> <span class="n">Bridge</span> <span class="ow">and</span> <span class="n">Upstream</span> <span class="n">Switch</span> <span class="n">Port</span> <span class="n">Decode</span> <span class="n">Flow</span>

<span class="n">IMPLEMENTATION</span> <span class="n">NOTE</span>
<span class="n">Device</span> <span class="n">Decode</span> <span class="n">Logic</span>
</pre></div>
</div>
<p>These notes imply that there are two logical groups of decoders.</p>
<ul class="simple">
<li><p>Routing Decoder - a decoder which routes accesses but does not translate
addresses from HPA to DPA.</p></li>
<li><p>Translating Decoder - a decoder which translates accesses from HPA to DPA
for an endpoint to service.</p></li>
</ul>
<p>The CXL drivers distinguish 3 decoder types: root, switch, and endpoint. Only
endpoint decoders are Translating Decoders, all others are Routing Decoders.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>PLATFORM VENDORS BE AWARE</p>
<p>Linux makes a strong assumption that endpoint decoders are the only decoder
in the fabric that actively translates HPA to DPA.  Linux assumes routing
decoders pass the HPA unchanged to the next decoder in the fabric.</p>
<p>It is therefore assumed that any given decoder in the fabric will have an
address range that is a subset of its upstream port decoder. Any deviation
from this scheme undefined per the specification.  Linux prioritizes
spec-defined / architectural behavior.</p>
</div>
<p>Decoders may have one or more <cite>Downstream Targets</cite> if configured to interleave
memory accesses.  This will be presented in sysfs via the <code class="code docutils literal notranslate"><span class="pre">target_list</span></code>
parameter.</p>
<section id="root-decoder">
<h5>Root Decoder<a class="headerlink" href="#root-decoder" title="Link to this heading"></a></h5>
<p>A <cite>Root Decoder</cite> is logical construct of the physical address and interleave
configurations present in the ACPI CEDT CFMWS.  Linux presents this information
as a decoder present in the <cite>CXL Root</cite>.  We consider this a <cite>Root Decoder</cite>,
though technically it exists on the boundary of the CXL specification and
platform-specific CXL root implementations.</p>
<p>Linux considers these logical decoders a type of <cite>Routing Decoder</cite>, and is the
first decoder in the CXL fabric to recieve a memory access from the platform’s
memory controllers.</p>
<p><cite>Root Decoders</cite> are created during <code class="code docutils literal notranslate"><span class="pre">cxl_acpi_probe</span></code>.  One root decoder
is created per CFMWS entry in the ACPI CEDT.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">target_list</span></code> parameter is filled by the CFMWS target fields. Targets
of a root decoder are <cite>Host Bridges</cite>, which means interleave done at the root
decoder level is an <cite>Inter-Host-Bridge Interleave</cite>.</p>
<p>Only root decoders are capable of <cite>Inter-Host-Bridge Interleave</cite>.</p>
<p>Such interleaves must be configured by the platform and described in the ACPI
CEDT CFMWS, as the target CXL host bridge UIDs in the CFMWS must match the CXL
host bridge UIDs in the ACPI CEDT CHBS and ACPI DSDT.</p>
<p>Interleave settings in a rootdecoder describe how to interleave accesses among
the <em>immediate downstream targets</em>, not the entire interleave set.</p>
<p>The memory range described in the root decoder is used to</p>
<ol class="arabic simple">
<li><p>Create a memory region (<code class="code docutils literal notranslate"><span class="pre">region0</span></code> in this example), and</p></li>
<li><p>Associate the region with an IO Memory Resource (<code class="code docutils literal notranslate"><span class="pre">kernel/resource.c</span></code>)</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ls /sys/bus/cxl/devices/decoder0.0/</span>
  <span class="n">cap_pmem</span>           <span class="n">devtype</span>                 <span class="n">region0</span>
  <span class="n">cap_ram</span>            <span class="n">interleave_granularity</span>  <span class="n">size</span>
  <span class="n">cap_type2</span>          <span class="n">interleave_ways</span>         <span class="n">start</span>
  <span class="n">cap_type3</span>          <span class="n">locked</span>                  <span class="n">subsystem</span>
  <span class="n">create_ram_region</span>  <span class="n">modalias</span>                <span class="n">target_list</span>
  <span class="n">delete_region</span>      <span class="n">qos_class</span>               <span class="n">uevent</span>

<span class="c1"># cat /sys/bus/cxl/devices/decoder0.0/region0/resource</span>
  <span class="mh">0xc050000000</span>
</pre></div>
</div>
<p>The IO Memory Resource is created during early boot when the CFMWS region is
identified in the EFI Memory Map or E820 table (on x86).</p>
<p>Root decoders are defined as a separate devtype, but are also a type
of <cite>Switch Decoder</cite> due to having downstream targets.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># cat /sys/bus/cxl/devices/decoder0.0/devtype</span>
  <span class="n">cxl_decoder_root</span>
</pre></div>
</div>
</section>
<section id="switch-decoder">
<h5>Switch Decoder<a class="headerlink" href="#switch-decoder" title="Link to this heading"></a></h5>
<p>Any non-root, translating decoder is considered a <cite>Switch Decoder</cite>, and will
present with the type <code class="code docutils literal notranslate"><span class="pre">cxl_decoder_switch</span></code>. Both <cite>Host Bridge</cite> and <cite>CXL
Switch</cite> (device) decoders are of type <code class="code docutils literal notranslate"><span class="pre">cxl_decoder_switch</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ls /sys/bus/cxl/devices/decoder1.0/</span>
  <span class="n">devtype</span>                 <span class="n">locked</span>    <span class="n">size</span>       <span class="n">target_list</span>
  <span class="n">interleave_granularity</span>  <span class="n">modalias</span>  <span class="n">start</span>      <span class="n">target_type</span>
  <span class="n">interleave_ways</span>         <span class="n">region</span>    <span class="n">subsystem</span>  <span class="n">uevent</span>

<span class="c1"># cat /sys/bus/cxl/devices/decoder1.0/devtype</span>
  <span class="n">cxl_decoder_switch</span>

<span class="c1"># cat /sys/bus/cxl/devices/decoder1.0/region</span>
  <span class="n">region0</span>
</pre></div>
</div>
<p>A <cite>Switch Decoder</cite> has associations between a region defined by a root
decoder and downstream target ports.  Interleaving done within a switch decoder
is a multi-downstream-port interleave (or <cite>Intra-Host-Bridge Interleave</cite> for
host bridges).</p>
<p>Interleave settings in a switch decoder describe how to interleave accesses
among the <em>immediate downstream targets</em>, not the entire interleave set.</p>
<p>Switch decoders are created during <code class="code docutils literal notranslate"><span class="pre">cxl_switch_port_probe</span></code> in the
<code class="code docutils literal notranslate"><span class="pre">cxl_port</span></code> driver, and is created based on a PCI device’s DVSEC
registers.</p>
<p>Switch decoder programming is validated during probe if the platform programs
them during boot (See <cite>Auto Decoders</cite> below), or on commit if programmed at
runtime (See <cite>Runtime Programming</cite> below).</p>
</section>
<section id="endpoint-decoder">
<h5>Endpoint Decoder<a class="headerlink" href="#endpoint-decoder" title="Link to this heading"></a></h5>
<p>Any decoder attached to a <em>terminal</em> point in the CXL fabric (<cite>An Endpoint</cite>) is
considered an <cite>Endpoint Decoder</cite>. Endpoint decoders are of type
<code class="code docutils literal notranslate"><span class="pre">cxl_decoder_endpoint</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ls /sys/bus/cxl/devices/decoder5.0</span>
  <span class="n">devtype</span>                 <span class="n">locked</span>    <span class="n">start</span>
  <span class="n">dpa_resource</span>            <span class="n">modalias</span>  <span class="n">subsystem</span>
  <span class="n">dpa_size</span>                <span class="n">mode</span>      <span class="n">target_type</span>
  <span class="n">interleave_granularity</span>  <span class="n">region</span>    <span class="n">uevent</span>
  <span class="n">interleave_ways</span>         <span class="n">size</span>

<span class="c1"># cat /sys/bus/cxl/devices/decoder5.0/devtype</span>
  <span class="n">cxl_decoder_endpoint</span>

<span class="c1"># cat /sys/bus/cxl/devices/decoder5.0/region</span>
  <span class="n">region0</span>
</pre></div>
</div>
<p>An <cite>Endpoint Decoder</cite> has an association with a region defined by a root
decoder and describes the device-local resource associated with this region.</p>
<p>Unlike root and switch decoders, endpoint decoders translate <cite>Host Physical</cite> to
<cite>Device Physical</cite> address ranges.  The interleave settings on an endpoint
therefore describe the entire <em>interleave set</em>.</p>
<p><cite>Device Physical Address</cite> regions must be committed in-order. For example, the
DPA region starting at 0x80000000 cannot be committed before the DPA region
starting at 0x0.</p>
<p>As of Linux v6.15, Linux does not support <em>imbalanced</em> interleave setups, all
endpoints in an interleave set are are expected to have the same interleave
settings (granularity and ways must be the same).</p>
<p>Endpoint decoders are created during <code class="code docutils literal notranslate"><span class="pre">cxl_endpoint_port_probe</span></code> in the
<code class="code docutils literal notranslate"><span class="pre">cxl_port</span></code> driver, and is created based on a PCI device’s DVSEC registers.</p>
</section>
</section>
<section id="regions">
<h4>Regions<a class="headerlink" href="#regions" title="Link to this heading"></a></h4>
<section id="memory-region">
<h5>Memory Region<a class="headerlink" href="#memory-region" title="Link to this heading"></a></h5>
<p>A <cite>Memory Region</cite> is a logical construct that connects a set of CXL ports in
the fabric to an IO Memory Resource.  It is ultimately used to expose the memory
on these devices to the DAX subsystem via a <cite>DAX Region</cite>.</p>
<p>An example RAM region:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ls /sys/bus/cxl/devices/region0/</span>
  <span class="n">access0</span>      <span class="n">devtype</span>                 <span class="n">modalias</span>  <span class="n">subsystem</span>  <span class="n">uuid</span>
  <span class="n">access1</span>      <span class="n">driver</span>                  <span class="n">mode</span>      <span class="n">target0</span>
  <span class="n">commit</span>       <span class="n">interleave_granularity</span>  <span class="n">resource</span>  <span class="n">target1</span>
  <span class="n">dax_region0</span>  <span class="n">interleave_ways</span>         <span class="n">size</span>      <span class="n">uevent</span>
</pre></div>
</div>
<p>A memory region can be constructed during endpoint probe, if decoders were
programmed by BIOS/EFI (see <cite>Auto Decoders</cite>), or by creating a region manually
via a <cite>Root Decoder</cite>’s <code class="code docutils literal notranslate"><span class="pre">create_ram_region</span></code> or <code class="code docutils literal notranslate"><span class="pre">create_pmem_region</span></code>
interfaces.</p>
<p>The interleave settings in a <cite>Memory Region</cite> describe the configuration of the
<cite>Interleave Set</cite> - and are what can be expected to be seen in the endpoint
interleave settings.</p>
</section>
<section id="dax-region">
<h5>DAX Region<a class="headerlink" href="#dax-region" title="Link to this heading"></a></h5>
<p>A <cite>DAX Region</cite> is used to convert a CXL <cite>Memory Region</cite> to a DAX device. A
DAX device may then be accessed directly via a file descriptor interface, or
converted to System RAM via the DAX kmem driver.  See the DAX driver section
for more details.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ls /sys/bus/cxl/devices/dax_region0/</span>
  <span class="n">dax0</span><span class="mf">.0</span>      <span class="n">devtype</span>  <span class="n">modalias</span>   <span class="n">uevent</span>
  <span class="n">dax_region</span>  <span class="n">driver</span>   <span class="n">subsystem</span>
</pre></div>
</div>
</section>
</section>
<section id="mailbox-interfaces">
<h4>Mailbox Interfaces<a class="headerlink" href="#mailbox-interfaces" title="Link to this heading"></a></h4>
<p>A mailbox command interface for each device is exposed in</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">cxl</span><span class="o">/</span><span class="n">mem0</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">cxl</span><span class="o">/</span><span class="n">mem1</span>
</pre></div>
</div>
<p>These mailboxes may receive any specification-defined command. Raw commands
(custom commands) can only be sent to these interfaces if the build config
<code class="code docutils literal notranslate"><span class="pre">CXL_MEM_RAW_COMMANDS</span></code> is set.  This is considered a debug and/or
development interface, not an officially supported mechanism for creation
of vendor-specific commands (see the <cite>fwctl</cite> subsystem for that).</p>
</section>
</section>
<section id="decoder-programming">
<h3>Decoder Programming<a class="headerlink" href="#decoder-programming" title="Link to this heading"></a></h3>
<section id="runtime-programming">
<h4>Runtime Programming<a class="headerlink" href="#runtime-programming" title="Link to this heading"></a></h4>
<p>During probe, the only decoders <em>required</em> to be programmed are <cite>Root Decoders</cite>.
In reality, <cite>Root Decoders</cite> are a logical construct to describe the memory
region and interleave configuration at the host bridge level - as described
in the ACPI CEDT CFMWS.</p>
<p>All other <cite>Switch</cite> and <cite>Endpoint</cite> decoders may be programmed by the user
at runtime - if the platform supports such configurations.</p>
<p>This interaction is what creates a <cite>Software Defined Memory</cite> environment.</p>
<p>See the <code class="code docutils literal notranslate"><span class="pre">cxl-cli</span></code> documentation for more information about how to
configure CXL decoders at runtime.</p>
</section>
<section id="auto-decoders">
<h4>Auto Decoders<a class="headerlink" href="#auto-decoders" title="Link to this heading"></a></h4>
<p>Auto Decoders are decoders programmed by BIOS/EFI at boot time, and are
almost always locked (cannot be changed).  This is done by a platform
which may have a static configuration - or certain quirks which may prevent
dynamic runtime changes to the decoders (such as requiring additional
controller programming within the CPU complex outside the scope of CXL).</p>
<p>Auto Decoders are probed automatically as long as the devices and memory
regions they are associated with probe without issue.  When probing Auto
Decoders, the driver’s primary responsibility is to ensure the fabric is
sane - as-if validating runtime programmed regions and decoders.</p>
<p>If Linux cannot validate auto-decoder configuration, the memory will not
be surfaced as a DAX device - and therefore not be exposed to the page
allocator - effectively stranding it.</p>
</section>
<section id="interleave">
<h4>Interleave<a class="headerlink" href="#interleave" title="Link to this heading"></a></h4>
<p>The Linux CXL driver supports <cite>Cross-Link First</cite> interleave. This dictates
how interleave is programmed at each decoder step, as the driver validates
the relationships between a decoder and it’s parent.</p>
<p>For example, in a <cite>Cross-Link First</cite> interleave setup with 16 endpoints
attached to 4 host bridges, linux expects the following ways/granularity
across the root, host bridge, and endpoints respectively.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                 <span class="n">ways</span>   <span class="n">granularity</span>
<span class="n">root</span>              <span class="mi">4</span>        <span class="mi">256</span>
<span class="n">host</span> <span class="n">bridge</span>       <span class="mi">4</span>       <span class="mi">1024</span>
<span class="n">endpoint</span>         <span class="mi">16</span>        <span class="mi">256</span>
</pre></div>
</div>
<p>At the root, every a given access will be routed to the
<code class="code docutils literal notranslate"><span class="pre">((HPA</span> <span class="pre">/</span> <span class="pre">256)</span> <span class="pre">%</span> <span class="pre">4)th</span></code> target host bridge. Within a host bridge, every
<code class="code docutils literal notranslate"><span class="pre">((HPA</span> <span class="pre">/</span> <span class="pre">1024)</span> <span class="pre">%</span> <span class="pre">4)th</span></code> target endpoint.  Each endpoint will translate
the access based on the entire 16 device interleave set.</p>
<p>Unbalanced interleave sets are not supported - decoders at a similar point
in the hierarchy (e.g. all host bridge decoders) must have the same ways and
granularity configuration.</p>
<section id="at-root">
<h5>At Root<a class="headerlink" href="#at-root" title="Link to this heading"></a></h5>
<p>Root decoder interleave is defined by the ACPI CEDT CFMWS.  The CEDT
may actually define multiple CFMWS configurations to describe the same
physical capacity - with the intent to allow users to decide at runtime
whether to online memory as interleaved or non-interleaved.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Fixed</span> <span class="n">Memory</span> <span class="n">Window</span> <span class="n">Structure</span><span class="p">]</span>
     <span class="n">Window</span> <span class="n">base</span> <span class="n">address</span> <span class="p">:</span> <span class="mi">0000000100000000</span>
             <span class="n">Window</span> <span class="n">size</span> <span class="p">:</span> <span class="mi">0000000100000000</span>
<span class="n">Interleave</span> <span class="n">Members</span> <span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="n">n</span><span class="p">)</span> <span class="p">:</span> <span class="mi">00</span>
   <span class="n">Interleave</span> <span class="n">Arithmetic</span> <span class="p">:</span> <span class="mi">00</span>
            <span class="n">First</span> <span class="n">Target</span> <span class="p">:</span> <span class="mi">00000007</span>

           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Fixed</span> <span class="n">Memory</span> <span class="n">Window</span> <span class="n">Structure</span><span class="p">]</span>
     <span class="n">Window</span> <span class="n">base</span> <span class="n">address</span> <span class="p">:</span> <span class="mi">0000000200000000</span>
             <span class="n">Window</span> <span class="n">size</span> <span class="p">:</span> <span class="mi">0000000100000000</span>
<span class="n">Interleave</span> <span class="n">Members</span> <span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="n">n</span><span class="p">)</span> <span class="p">:</span> <span class="mi">00</span>
   <span class="n">Interleave</span> <span class="n">Arithmetic</span> <span class="p">:</span> <span class="mi">00</span>
            <span class="n">First</span> <span class="n">Target</span> <span class="p">:</span> <span class="mi">00000006</span>

           <span class="n">Subtable</span> <span class="n">Type</span> <span class="p">:</span> <span class="mi">01</span> <span class="p">[</span><span class="n">CXL</span> <span class="n">Fixed</span> <span class="n">Memory</span> <span class="n">Window</span> <span class="n">Structure</span><span class="p">]</span>
     <span class="n">Window</span> <span class="n">base</span> <span class="n">address</span> <span class="p">:</span> <span class="mi">0000000300000000</span>
             <span class="n">Window</span> <span class="n">size</span> <span class="p">:</span> <span class="mi">0000000200000000</span>
<span class="n">Interleave</span> <span class="n">Members</span> <span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="n">n</span><span class="p">)</span> <span class="p">:</span> <span class="mi">01</span>
   <span class="n">Interleave</span> <span class="n">Arithmetic</span> <span class="p">:</span> <span class="mi">00</span>
            <span class="n">First</span> <span class="n">Target</span> <span class="p">:</span> <span class="mi">00000007</span>
             <span class="n">Next</span> <span class="n">Target</span> <span class="p">:</span> <span class="mi">00000006</span>
</pre></div>
</div>
<p>In this example, the CFMWS defines two discrete non-interleaved 4GB regions
for each host bridge, and one interleaved 8GB region that targets both. This
would result in 3 root decoders presenting in the root.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ls /sys/bus/cxl/devices/root0</span>
  <span class="n">decoder0</span><span class="mf">.0</span>  <span class="n">decoder0</span><span class="mf">.1</span>  <span class="n">decoder0</span><span class="mf">.2</span>

<span class="c1"># cat /sys/bus/cxl/devices/decoder0.0/target_list start size</span>
  <span class="mi">7</span>
  <span class="mh">0x100000000</span>
  <span class="mh">0x100000000</span>

<span class="c1"># cat /sys/bus/cxl/devices/decoder0.1/target_list start size</span>
  <span class="mi">6</span>
  <span class="mh">0x200000000</span>
  <span class="mh">0x100000000</span>

<span class="c1"># cat /sys/bus/cxl/devices/decoder0.2/target_list start size</span>
  <span class="mi">7</span><span class="p">,</span><span class="mi">6</span>
  <span class="mh">0x300000000</span>
  <span class="mh">0x200000000</span>
</pre></div>
</div>
<p>These decoders are not runtime programmable.  They are used to generate a
<cite>Memory Region</cite> to bring this memory online with runtime programmed settings
at the <cite>Switch</cite> and <cite>Endpoint</cite> decoders.</p>
</section>
<section id="at-host-bridge-or-switch">
<h5>At Host Bridge or Switch<a class="headerlink" href="#at-host-bridge-or-switch" title="Link to this heading"></a></h5>
<p><cite>Host Bridge</cite> and <cite>Switch</cite> decoders are programmable via the following fields:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">start</span></code> - the HPA region associated with the memory region</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">size</span></code> - the size of the region</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">target_list</span></code> - the list of downstream ports</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">interleave_ways</span></code> - the number downstream ports to interleave across</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">interleave_granularity</span></code> - the granularity to interleave at.</p></li>
</ul>
<p>Linux expects the <code class="code docutils literal notranslate"><span class="pre">interleave_granularity</span></code> of switch decoders to be
derived from their upstream port connections. In <cite>Cross-Link First</cite> interleave
configurations, the <code class="code docutils literal notranslate"><span class="pre">interleave_granularity</span></code> of a decoder is equal to
<code class="code docutils literal notranslate"><span class="pre">parent_interleave_granularity</span> <span class="pre">*</span> <span class="pre">parent_interleave_ways</span></code>.</p>
</section>
<section id="at-endpoint">
<h5>At Endpoint<a class="headerlink" href="#at-endpoint" title="Link to this heading"></a></h5>
<p><cite>Endpoint Decoders</cite> are programmed similar to Host Bridge and Switch decoders,
with the exception that the ways and granularity are defined by the interleave
set (e.g. the interleave settings defined by the associated <cite>Memory Region</cite>).</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">start</span></code> - the HPA region associated with the memory region</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">size</span></code> - the size of the region</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">interleave_ways</span></code> - the number endpoints in the interleave set</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">interleave_granularity</span></code> - the granularity to interleave at.</p></li>
</ul>
<p>These settings are used by endpoint decoders to <em>Translate</em> memory requests
from HPA to DPA.  This is why they must be aware of the entire interleave set.</p>
<p>Linux does not support unbalanced interleave configurations.  As a result, all
endpoints in an interleave set must have the same ways and granularity.</p>
</section>
</section>
</section>
<section id="example-configurations">
<h3>Example Configurations<a class="headerlink" href="#example-configurations" title="Link to this heading"></a></h3>
<div class="toctree-wrapper compound">
<span id="document-linux/example-configurations/single-device"></span><section id="single-device">
<h4>Single Device<a class="headerlink" href="#single-device" title="Link to this heading"></a></h4>
<p>This cxl-cli configuration dump shows the following host configuration:</p>
<ul class="simple">
<li><p>A single socket system with one CXL root</p></li>
<li><p>CXL Root has Four (4) CXL Host Bridges</p></li>
<li><p>One CXL Host Bridges has a single CXL Memory Expander Attached</p></li>
<li><p>No interleave is present.</p></li>
</ul>
<p>This output is generated by <code class="code docutils literal notranslate"><span class="pre">cxl</span> <span class="pre">list</span> <span class="pre">-v</span></code> and describes the relationships
between objects exposed in <code class="code docutils literal notranslate"><span class="pre">/sys/bus/cxl/devices/</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
      <span class="s2">&quot;bus&quot;</span><span class="p">:</span><span class="s2">&quot;root0&quot;</span><span class="p">,</span>
      <span class="s2">&quot;provider&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI.CXL&quot;</span><span class="p">,</span>
      <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
      <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
          <span class="p">{</span>
              <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:00&quot;</span><span class="p">,</span>
              <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:01&quot;</span><span class="p">,</span>
              <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
          <span class="p">},</span>
          <span class="p">{</span>
              <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:a8&quot;</span><span class="p">,</span>
              <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:02&quot;</span><span class="p">,</span>
              <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">4</span>
          <span class="p">},</span>
          <span class="p">{</span>
              <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:2a&quot;</span><span class="p">,</span>
              <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:03&quot;</span><span class="p">,</span>
              <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span>
          <span class="p">},</span>
          <span class="p">{</span>
              <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:d2&quot;</span><span class="p">,</span>
              <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:00&quot;</span><span class="p">,</span>
              <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">5</span>
          <span class="p">}</span>
      <span class="p">],</span>
</pre></div>
</div>
<p>This chunk shows the CXL “bus” (root0) has 4 downstream ports attached to CXL
Host Bridges.  The <cite>Root</cite> can be considered the singular upstream port attached
to the platform’s memory controller - which routes memory requests to it.</p>
<p>The <cite>ports:root0</cite> section lays out how each of these downstream ports are
configured.  If a port is not configured (id’s 0, 1, and 4), they are omitted.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;ports:root0&quot;</span><span class="p">:[</span>
    <span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="p">:</span><span class="s2">&quot;port1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:d2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:02&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:05&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">2</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:07.1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:0d&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">113</span>
            <span class="p">}</span>
        <span class="p">],</span>
</pre></div>
</div>
<p>This chunk shows the available downstream ports associated with the CXL Host
Bridge <code class="code docutils literal notranslate"><span class="pre">port1</span></code>.  In this case, <code class="code docutils literal notranslate"><span class="pre">port1</span></code> has 3 avaiable downstream
ports: <code class="code docutils literal notranslate"><span class="pre">dport1</span></code>, <code class="code docutils literal notranslate"><span class="pre">dport2</span></code>, and <code class="code docutils literal notranslate"><span class="pre">dport113</span></code>..</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;endpoints:port1&quot;</span><span class="p">:[</span>
    <span class="p">{</span>
        <span class="s2">&quot;endpoint&quot;</span><span class="p">:</span><span class="s2">&quot;endpoint5&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;mem0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parent_dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;memdev&quot;</span><span class="p">:{</span>
            <span class="s2">&quot;memdev&quot;</span><span class="p">:</span><span class="s2">&quot;mem0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ram_size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
            <span class="s2">&quot;serial&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;numa_node&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d3:00.0&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;decoders:endpoint5&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder5.0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
                <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
                <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="s2">&quot;region0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dpa_resource&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;dpa_size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
                <span class="s2">&quot;mode&quot;</span><span class="p">:</span><span class="s2">&quot;ram&quot;</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">],</span>
</pre></div>
</div>
<p>This chunk shows the endpoints attached to the host bridge <code class="code docutils literal notranslate"><span class="pre">port1</span></code>.</p>
<p><code class="code docutils literal notranslate"><span class="pre">endpoint5</span></code> contains a single configured decoder <code class="code docutils literal notranslate"><span class="pre">decoder5.0</span></code>
which has the same interleave configuration as <code class="code docutils literal notranslate"><span class="pre">region0</span></code> (shown later).</p>
<p>Next we have the decoders belonging to the host bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="s2">&quot;decoders:port1&quot;</span><span class="p">:[</span>
        <span class="p">{</span>
            <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder1.0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
            <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
            <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="s2">&quot;region0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nr_targets&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;targets&quot;</span><span class="p">:[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;target&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:02&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">},</span>
</pre></div>
</div>
<p>Host Bridge <code class="code docutils literal notranslate"><span class="pre">port1</span></code> has a single decoder (<code class="code docutils literal notranslate"><span class="pre">decoder1.0</span></code>), whose only
target is <code class="code docutils literal notranslate"><span class="pre">dport1</span></code> - which is attached to <code class="code docutils literal notranslate"><span class="pre">endpoint5</span></code>.</p>
<p>The next chunk shows the three CXL host bridges without attached endpoints.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="p">:</span><span class="s2">&quot;port2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:00:01.3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:55&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">2</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:00:07.1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:5d&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">113</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="p">:</span><span class="s2">&quot;port3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:a8&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:a8:01.1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:c3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="p">:</span><span class="s2">&quot;port4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:2a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:2a:01.1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:d0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">],</span>
</pre></div>
</div>
<p>Next we have the <cite>Root Decoders</cite> belonging to <code class="code docutils literal notranslate"><span class="pre">root0</span></code>.  This root decoder
is a pass-through decoder because <code class="code docutils literal notranslate"><span class="pre">interleave_ways</span></code> is set to <code class="code docutils literal notranslate"><span class="pre">1</span></code>.</p>
<p>This information is generated by the CXL driver reading the ACPI CEDT CMFWS.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;decoders:root0&quot;</span><span class="p">:[</span>
    <span class="p">{</span>
        <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder0.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
        <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
        <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;max_available_extent&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;volatile_capable&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">,</span>
        <span class="s2">&quot;nr_targets&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;targets&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;target&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:d2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:00&quot;</span><span class="p">,</span>
                <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">5</span>
            <span class="p">}</span>
        <span class="p">],</span>
</pre></div>
</div>
<p>Finally we have the <cite>Memory Region</cite> associated with the <cite>Root Decoder</cite>
<code class="code docutils literal notranslate"><span class="pre">decoder0.0</span></code>.  This region describes the discrete region associated
with the lone device.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>              <span class="s2">&quot;regions:decoder0.0&quot;</span><span class="p">:[</span>
                  <span class="p">{</span>
                      <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="s2">&quot;region0&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
                      <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
                      <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;ram&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                      <span class="s2">&quot;decode_state&quot;</span><span class="p">:</span><span class="s2">&quot;commit&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;mappings&quot;</span><span class="p">:[</span>
                          <span class="p">{</span>
                              <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                              <span class="s2">&quot;memdev&quot;</span><span class="p">:</span><span class="s2">&quot;mem0&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder5.0&quot;</span>
                          <span class="p">}</span>
                      <span class="p">]</span>
                  <span class="p">}</span>
              <span class="p">]</span>
          <span class="p">}</span>
      <span class="p">]</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<span id="document-linux/example-configurations/hb-interleave"></span><section id="inter-host-bridge-interleave">
<h4>Inter-Host-Bridge Interleave<a class="headerlink" href="#inter-host-bridge-interleave" title="Link to this heading"></a></h4>
<p>This cxl-cli configuration dump shows the following host configuration:</p>
<ul class="simple">
<li><p>A single socket system with one CXL root</p></li>
<li><p>CXL Root has Four (4) CXL Host Bridges</p></li>
<li><p>Two CXL Host Bridges have a single CXL Memory Expander Attached</p></li>
<li><p>The CXL root is configured to interleave across the two host bridges.</p></li>
</ul>
<p>This output is generated by <code class="code docutils literal notranslate"><span class="pre">cxl</span> <span class="pre">list</span> <span class="pre">-v</span></code> and describes the relationships
between objects exposed in <code class="code docutils literal notranslate"><span class="pre">/sys/bus/cxl/devices/</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
      <span class="s2">&quot;bus&quot;</span><span class="p">:</span><span class="s2">&quot;root0&quot;</span><span class="p">,</span>
      <span class="s2">&quot;provider&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI.CXL&quot;</span><span class="p">,</span>
      <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
      <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
          <span class="p">{</span>
              <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:00&quot;</span><span class="p">,</span>
              <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:01&quot;</span><span class="p">,</span>
              <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
          <span class="p">},</span>
          <span class="p">{</span>
              <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:a8&quot;</span><span class="p">,</span>
              <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:02&quot;</span><span class="p">,</span>
              <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">4</span>
          <span class="p">},</span>
          <span class="p">{</span>
              <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:2a&quot;</span><span class="p">,</span>
              <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:03&quot;</span><span class="p">,</span>
              <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span>
          <span class="p">},</span>
          <span class="p">{</span>
              <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:d2&quot;</span><span class="p">,</span>
              <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:00&quot;</span><span class="p">,</span>
              <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">5</span>
          <span class="p">}</span>
      <span class="p">],</span>
</pre></div>
</div>
<p>This chunk shows the CXL “bus” (root0) has 4 downstream ports attached to CXL
Host Bridges.  The <cite>Root</cite> can be considered the singular upstream port attached
to the platform’s memory controller - which routes memory requests to it.</p>
<p>The <cite>ports:root0</cite> section lays out how each of these downstream ports are
configured.  If a port is not configured (id’s 0 and 1), they are omitted.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;ports:root0&quot;</span><span class="p">:[</span>
    <span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="p">:</span><span class="s2">&quot;port1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:d2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:02&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:05&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">2</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:07.1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:0d&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">113</span>
            <span class="p">}</span>
        <span class="p">],</span>
</pre></div>
</div>
<p>This chunk shows the available downstream ports associated with the CXL Host
Bridge <code class="code docutils literal notranslate"><span class="pre">port1</span></code>.  In this case, <code class="code docutils literal notranslate"><span class="pre">port1</span></code> has 3 avaiable downstream
ports: <code class="code docutils literal notranslate"><span class="pre">dport1</span></code>, <code class="code docutils literal notranslate"><span class="pre">dport2</span></code>, and <code class="code docutils literal notranslate"><span class="pre">dport113</span></code>..</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;endpoints:port1&quot;</span><span class="p">:[</span>
    <span class="p">{</span>
        <span class="s2">&quot;endpoint&quot;</span><span class="p">:</span><span class="s2">&quot;endpoint5&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;mem0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parent_dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;memdev&quot;</span><span class="p">:{</span>
            <span class="s2">&quot;memdev&quot;</span><span class="p">:</span><span class="s2">&quot;mem0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ram_size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
            <span class="s2">&quot;serial&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;numa_node&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d3:00.0&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;decoders:endpoint5&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder5.0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
                <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">274877906944</span><span class="p">,</span>
                <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;interleave_granularity&quot;</span><span class="p">:</span><span class="mi">256</span><span class="p">,</span>
                <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="s2">&quot;region0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dpa_resource&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;dpa_size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
                <span class="s2">&quot;mode&quot;</span><span class="p">:</span><span class="s2">&quot;ram&quot;</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">],</span>
</pre></div>
</div>
<p>This chunk shows the endpoints attached to the host bridge <code class="code docutils literal notranslate"><span class="pre">port1</span></code>.</p>
<p><code class="code docutils literal notranslate"><span class="pre">endpoint5</span></code> contains a single configured decoder <code class="code docutils literal notranslate"><span class="pre">decoder5.0</span></code>
which has the same interleave configuration as <code class="code docutils literal notranslate"><span class="pre">region0</span></code> (shown later).</p>
<p>Next we have the decodesr belonging to the host bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="s2">&quot;decoders:port1&quot;</span><span class="p">:[</span>
        <span class="p">{</span>
            <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder1.0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
            <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">274877906944</span><span class="p">,</span>
            <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="s2">&quot;region0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nr_targets&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;targets&quot;</span><span class="p">:[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;target&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:02&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">},</span>
</pre></div>
</div>
<p>Host Bridge <code class="code docutils literal notranslate"><span class="pre">port1</span></code> has a single decoder (<code class="code docutils literal notranslate"><span class="pre">decoder1.0</span></code>), whose only
target is <code class="code docutils literal notranslate"><span class="pre">dport1</span></code> - which is attached to <code class="code docutils literal notranslate"><span class="pre">endpoint5</span></code>.</p>
<p>The following chunk shows a similar configuration for Host Bridge <code class="code docutils literal notranslate"><span class="pre">port3</span></code>,
the second host bridge with a memory device attached.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;port&quot;</span><span class="p">:</span><span class="s2">&quot;port3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:a8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
        <span class="p">{</span>
            <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:a8:01.1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:c3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;endpoints:port3&quot;</span><span class="p">:[</span>
        <span class="p">{</span>
            <span class="s2">&quot;endpoint&quot;</span><span class="p">:</span><span class="s2">&quot;endpoint6&quot;</span><span class="p">,</span>
            <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;mem1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;parent_dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:a8:01.1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;memdev&quot;</span><span class="p">:{</span>
                <span class="s2">&quot;memdev&quot;</span><span class="p">:</span><span class="s2">&quot;mem1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ram_size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
                <span class="s2">&quot;serial&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;numa_node&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;0000:a9:00.0&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;decoders:endpoint6&quot;</span><span class="p">:[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder6.0&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
                    <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">274877906944</span><span class="p">,</span>
                    <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                    <span class="s2">&quot;interleave_granularity&quot;</span><span class="p">:</span><span class="mi">256</span><span class="p">,</span>
                    <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="s2">&quot;region0&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;dpa_resource&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;dpa_size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
                    <span class="s2">&quot;mode&quot;</span><span class="p">:</span><span class="s2">&quot;ram&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;decoders:port3&quot;</span><span class="p">:[</span>
        <span class="p">{</span>
            <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder3.0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
            <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">274877906944</span><span class="p">,</span>
            <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="s2">&quot;region0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nr_targets&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;targets&quot;</span><span class="p">:[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;target&quot;</span><span class="p">:</span><span class="s2">&quot;0000:a8:01.1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:c3&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">},</span>
</pre></div>
</div>
<p>The next chunk shows the two CXL host bridges without attached endpoints.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="p">:</span><span class="s2">&quot;port2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:00:01.3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:55&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">2</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:00:07.1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:5d&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">113</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="p">:</span><span class="s2">&quot;port4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:2a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:2a:01.1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:d0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">],</span>
</pre></div>
</div>
<p>Next we have the <cite>Root Decoders</cite> belonging to <code class="code docutils literal notranslate"><span class="pre">root0</span></code>.  This root decoder
applies the interleave across the downstream ports <code class="code docutils literal notranslate"><span class="pre">port1</span></code> and
<code class="code docutils literal notranslate"><span class="pre">port3</span></code> - with a granularity of 256 bytes.</p>
<p>This information is generated by the CXL driver reading the ACPI CEDT CMFWS.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;decoders:root0&quot;</span><span class="p">:[</span>
    <span class="p">{</span>
        <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder0.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
        <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">274877906944</span><span class="p">,</span>
        <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;interleave_granularity&quot;</span><span class="p">:</span><span class="mi">256</span><span class="p">,</span>
        <span class="s2">&quot;max_available_extent&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;volatile_capable&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">,</span>
        <span class="s2">&quot;nr_targets&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;targets&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;target&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:a8&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:02&quot;</span><span class="p">,</span>
                <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">4</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;target&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:d2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:00&quot;</span><span class="p">,</span>
                <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">5</span>
            <span class="p">}</span>
        <span class="p">],</span>
</pre></div>
</div>
<p>Finally we have the <cite>Memory Region</cite> associated with the <cite>Root Decoder</cite>
<code class="code docutils literal notranslate"><span class="pre">decoder0.0</span></code>.  This region describes the overall interleave configuration
of the interleave set.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>              <span class="s2">&quot;regions:decoder0.0&quot;</span><span class="p">:[</span>
                  <span class="p">{</span>
                      <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="s2">&quot;region0&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
                      <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">274877906944</span><span class="p">,</span>
                      <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;ram&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                      <span class="s2">&quot;interleave_granularity&quot;</span><span class="p">:</span><span class="mi">256</span><span class="p">,</span>
                      <span class="s2">&quot;decode_state&quot;</span><span class="p">:</span><span class="s2">&quot;commit&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;mappings&quot;</span><span class="p">:[</span>
                          <span class="p">{</span>
                              <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                              <span class="s2">&quot;memdev&quot;</span><span class="p">:</span><span class="s2">&quot;mem1&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder6.0&quot;</span>
                          <span class="p">},</span>
                          <span class="p">{</span>
                              <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                              <span class="s2">&quot;memdev&quot;</span><span class="p">:</span><span class="s2">&quot;mem0&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder5.0&quot;</span>
                          <span class="p">}</span>
                      <span class="p">]</span>
                  <span class="p">}</span>
              <span class="p">]</span>
          <span class="p">}</span>
      <span class="p">]</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<span id="document-linux/example-configurations/intra-hb-interleave"></span><section id="intra-host-bridge-interleave">
<h4>Intra-Host-Bridge Interleave<a class="headerlink" href="#intra-host-bridge-interleave" title="Link to this heading"></a></h4>
<p>This cxl-cli configuration dump shows the following host configuration:</p>
<ul class="simple">
<li><p>A single socket system with one CXL root</p></li>
<li><p>CXL Root has Four (4) CXL Host Bridges</p></li>
<li><p>One (1) CXL Host Bridges has two CXL Memory Expanders Attached</p></li>
<li><p>The Host bridge decoder is programmed to interleave across the expanders.</p></li>
</ul>
<p>This output is generated by <code class="code docutils literal notranslate"><span class="pre">cxl</span> <span class="pre">list</span> <span class="pre">-v</span></code> and describes the relationships
between objects exposed in <code class="code docutils literal notranslate"><span class="pre">/sys/bus/cxl/devices/</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
      <span class="s2">&quot;bus&quot;</span><span class="p">:</span><span class="s2">&quot;root0&quot;</span><span class="p">,</span>
      <span class="s2">&quot;provider&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI.CXL&quot;</span><span class="p">,</span>
      <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
      <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
          <span class="p">{</span>
              <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:00&quot;</span><span class="p">,</span>
              <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:01&quot;</span><span class="p">,</span>
              <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
          <span class="p">},</span>
          <span class="p">{</span>
              <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:a8&quot;</span><span class="p">,</span>
              <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:02&quot;</span><span class="p">,</span>
              <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">4</span>
          <span class="p">},</span>
          <span class="p">{</span>
              <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:2a&quot;</span><span class="p">,</span>
              <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:03&quot;</span><span class="p">,</span>
              <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span>
          <span class="p">},</span>
          <span class="p">{</span>
              <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:d2&quot;</span><span class="p">,</span>
              <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:00&quot;</span><span class="p">,</span>
              <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">5</span>
          <span class="p">}</span>
      <span class="p">],</span>
</pre></div>
</div>
<p>This chunk shows the CXL “bus” (root0) has 4 downstream ports attached to CXL
Host Bridges.  The <cite>Root</cite> can be considered the singular upstream port attached
to the platform’s memory controller - which routes memory requests to it.</p>
<p>The <cite>ports:root0</cite> section lays out how each of these downstream ports are
configured.  If a port is not configured (id’s 0 and 1), they are omitted.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;ports:root0&quot;</span><span class="p">:[</span>
    <span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="p">:</span><span class="s2">&quot;port1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:d2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:02&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:05&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">2</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:07.1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:0d&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">113</span>
            <span class="p">}</span>
        <span class="p">],</span>
</pre></div>
</div>
<p>This chunk shows the available downstream ports associated with the CXL Host
Bridge <code class="code docutils literal notranslate"><span class="pre">port1</span></code>.  In this case, <code class="code docutils literal notranslate"><span class="pre">port1</span></code> has 3 avaiable downstream
ports: <code class="code docutils literal notranslate"><span class="pre">dport1</span></code>, <code class="code docutils literal notranslate"><span class="pre">dport2</span></code>, and <code class="code docutils literal notranslate"><span class="pre">dport113</span></code>..</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;endpoints:port1&quot;</span><span class="p">:[</span>
    <span class="p">{</span>
        <span class="s2">&quot;endpoint&quot;</span><span class="p">:</span><span class="s2">&quot;endpoint5&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;mem0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parent_dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;memdev&quot;</span><span class="p">:{</span>
            <span class="s2">&quot;memdev&quot;</span><span class="p">:</span><span class="s2">&quot;mem0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ram_size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
            <span class="s2">&quot;serial&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;numa_node&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d3:00.0&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;decoders:endpoint5&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder5.0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
                <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">274877906944</span><span class="p">,</span>
                <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;interleave_granularity&quot;</span><span class="p">:</span><span class="mi">256</span><span class="p">,</span>
                <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="s2">&quot;region0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dpa_resource&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;dpa_size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
                <span class="s2">&quot;mode&quot;</span><span class="p">:</span><span class="s2">&quot;ram&quot;</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;endpoint&quot;</span><span class="p">:</span><span class="s2">&quot;endpoint6&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;mem1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parent_dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.3,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;memdev&quot;</span><span class="p">:{</span>
            <span class="s2">&quot;memdev&quot;</span><span class="p">:</span><span class="s2">&quot;mem1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ram_size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
            <span class="s2">&quot;serial&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;numa_node&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;0000:a9:00.0&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;decoders:endpoint6&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder6.0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
                <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">274877906944</span><span class="p">,</span>
                <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;interleave_granularity&quot;</span><span class="p">:</span><span class="mi">256</span><span class="p">,</span>
                <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="s2">&quot;region0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dpa_resource&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;dpa_size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
                <span class="s2">&quot;mode&quot;</span><span class="p">:</span><span class="s2">&quot;ram&quot;</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">],</span>
</pre></div>
</div>
<p>This chunk shows the endpoints attached to the host bridge <code class="code docutils literal notranslate"><span class="pre">port1</span></code>.</p>
<p><code class="code docutils literal notranslate"><span class="pre">endpoint5</span></code> contains a single configured decoder <code class="code docutils literal notranslate"><span class="pre">decoder5.0</span></code>
which has the same interleave configuration memory region they belong to
(show later).</p>
<p>Next we have the decoders belonging to the host bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="s2">&quot;decoders:port1&quot;</span><span class="p">:[</span>
        <span class="p">{</span>
            <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder1.0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
            <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">274877906944</span><span class="p">,</span>
            <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;interleave_granularity&quot;</span><span class="p">:</span><span class="mi">256</span><span class="p">,</span>
            <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="s2">&quot;region0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nr_targets&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;targets&quot;</span><span class="p">:[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;target&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:02&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;target&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.3&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:05&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">},</span>
</pre></div>
</div>
<p>Host Bridge <code class="code docutils literal notranslate"><span class="pre">port1</span></code> has a single decoder (<code class="code docutils literal notranslate"><span class="pre">decoder1.0</span></code>) with two
targets: <code class="code docutils literal notranslate"><span class="pre">dport1</span></code> and <code class="code docutils literal notranslate"><span class="pre">dport3</span></code> - which are attached to
<code class="code docutils literal notranslate"><span class="pre">endpoint5</span></code> and <code class="code docutils literal notranslate"><span class="pre">endpoint6</span></code> respectively.</p>
<p>The host bridge decoder interleaves these devices at a 256 byte granularity.</p>
<p>The next chunk shows the three CXL host bridges without attached endpoints.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="p">:</span><span class="s2">&quot;port2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:00:01.3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:55&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">2</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:00:07.1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:5d&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">113</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="p">:</span><span class="s2">&quot;port3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:a8&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:a8:01.1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:c3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
            <span class="p">}</span>
        <span class="p">],</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="p">:</span><span class="s2">&quot;port4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:2a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:2a:01.1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:d0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">],</span>
</pre></div>
</div>
<p>Next we have the <cite>Root Decoders</cite> belonging to <code class="code docutils literal notranslate"><span class="pre">root0</span></code>.  This root decoder
applies the interleave across the downstream ports <code class="code docutils literal notranslate"><span class="pre">port1</span></code> and
<code class="code docutils literal notranslate"><span class="pre">port3</span></code> - with a granularity of 256 bytes.</p>
<p>This information is generated by the CXL driver reading the ACPI CEDT CMFWS.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;decoders:root0&quot;</span><span class="p">:[</span>
    <span class="p">{</span>
        <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder0.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
        <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">274877906944</span><span class="p">,</span>
        <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;max_available_extent&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;volatile_capable&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">,</span>
        <span class="s2">&quot;nr_targets&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;targets&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;target&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:a8&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:02&quot;</span><span class="p">,</span>
                <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">4</span>
            <span class="p">},</span>
        <span class="p">],</span>
</pre></div>
</div>
<p>Finally we have the <cite>Memory Region</cite> associated with the <cite>Root Decoder</cite>
<code class="code docutils literal notranslate"><span class="pre">decoder0.0</span></code>.  This region describes the overall interleave configuration
of the interleave set.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>              <span class="s2">&quot;regions:decoder0.0&quot;</span><span class="p">:[</span>
                  <span class="p">{</span>
                      <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="s2">&quot;region0&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
                      <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">274877906944</span><span class="p">,</span>
                      <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;ram&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                      <span class="s2">&quot;interleave_granularity&quot;</span><span class="p">:</span><span class="mi">256</span><span class="p">,</span>
                      <span class="s2">&quot;decode_state&quot;</span><span class="p">:</span><span class="s2">&quot;commit&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;mappings&quot;</span><span class="p">:[</span>
                          <span class="p">{</span>
                              <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                              <span class="s2">&quot;memdev&quot;</span><span class="p">:</span><span class="s2">&quot;mem1&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder6.0&quot;</span>
                          <span class="p">},</span>
                          <span class="p">{</span>
                              <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                              <span class="s2">&quot;memdev&quot;</span><span class="p">:</span><span class="s2">&quot;mem0&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder5.0&quot;</span>
                          <span class="p">}</span>
                      <span class="p">]</span>
                  <span class="p">}</span>
              <span class="p">]</span>
          <span class="p">}</span>
      <span class="p">]</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<span id="document-linux/example-configurations/multi-interleave"></span><section id="multi-level-interleave">
<h4>Multi-Level Interleave<a class="headerlink" href="#multi-level-interleave" title="Link to this heading"></a></h4>
<p>This cxl-cli configuration dump shows the following host configuration:</p>
<ul class="simple">
<li><p>A single socket system with one CXL root</p></li>
<li><p>CXL Root has Four (4) CXL Host Bridges</p></li>
<li><p>Two CXL Host Bridges have a two CXL Memory Expanders Attached each.</p></li>
<li><p>The CXL root is configured to interleave across the two host bridges.</p></li>
<li><p>Each host bridge with expanders interleaves across two endpoints.</p></li>
</ul>
<p>This output is generated by <code class="code docutils literal notranslate"><span class="pre">cxl</span> <span class="pre">list</span> <span class="pre">-v</span></code> and describes the relationships
between objects exposed in <code class="code docutils literal notranslate"><span class="pre">/sys/bus/cxl/devices/</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
      <span class="s2">&quot;bus&quot;</span><span class="p">:</span><span class="s2">&quot;root0&quot;</span><span class="p">,</span>
      <span class="s2">&quot;provider&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI.CXL&quot;</span><span class="p">,</span>
      <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
      <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
          <span class="p">{</span>
              <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:00&quot;</span><span class="p">,</span>
              <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:01&quot;</span><span class="p">,</span>
              <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
          <span class="p">},</span>
          <span class="p">{</span>
              <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:a8&quot;</span><span class="p">,</span>
              <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:02&quot;</span><span class="p">,</span>
              <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">4</span>
          <span class="p">},</span>
          <span class="p">{</span>
              <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:2a&quot;</span><span class="p">,</span>
              <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:03&quot;</span><span class="p">,</span>
              <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span>
          <span class="p">},</span>
          <span class="p">{</span>
              <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:d2&quot;</span><span class="p">,</span>
              <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:00&quot;</span><span class="p">,</span>
              <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">5</span>
          <span class="p">}</span>
      <span class="p">],</span>
</pre></div>
</div>
<p>This chunk shows the CXL “bus” (root0) has 4 downstream ports attached to CXL
Host Bridges.  The <cite>Root</cite> can be considered the singular upstream port attached
to the platform’s memory controller - which routes memory requests to it.</p>
<p>The <cite>ports:root0</cite> section lays out how each of these downstream ports are
configured.  If a port is not configured (id’s 0 and 1), they are omitted.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;ports:root0&quot;</span><span class="p">:[</span>
    <span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="p">:</span><span class="s2">&quot;port1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:d2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:02&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:05&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">2</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:07.1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:0d&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">113</span>
            <span class="p">}</span>
        <span class="p">],</span>
</pre></div>
</div>
<p>This chunk shows the available downstream ports associated with the CXL Host
Bridge <code class="code docutils literal notranslate"><span class="pre">port1</span></code>.  In this case, <code class="code docutils literal notranslate"><span class="pre">port1</span></code> has 3 avaiable downstream
ports: <code class="code docutils literal notranslate"><span class="pre">dport0</span></code>, <code class="code docutils literal notranslate"><span class="pre">dport2</span></code>, and <code class="code docutils literal notranslate"><span class="pre">dport113</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;endpoints:port1&quot;</span><span class="p">:[</span>
    <span class="p">{</span>
        <span class="s2">&quot;endpoint&quot;</span><span class="p">:</span><span class="s2">&quot;endpoint5&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;mem0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parent_dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;memdev&quot;</span><span class="p">:{</span>
            <span class="s2">&quot;memdev&quot;</span><span class="p">:</span><span class="s2">&quot;mem0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ram_size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
            <span class="s2">&quot;serial&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;numa_node&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d3:00.0&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;decoders:endpoint5&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder5.0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
                <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">549755813888</span><span class="p">,</span>
                <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
                <span class="s2">&quot;interleave_granularity&quot;</span><span class="p">:</span><span class="mi">256</span><span class="p">,</span>
                <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="s2">&quot;region0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dpa_resource&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;dpa_size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
                <span class="s2">&quot;mode&quot;</span><span class="p">:</span><span class="s2">&quot;ram&quot;</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;endpoint&quot;</span><span class="p">:</span><span class="s2">&quot;endpoint6&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;mem1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parent_dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;memdev&quot;</span><span class="p">:{</span>
            <span class="s2">&quot;memdev&quot;</span><span class="p">:</span><span class="s2">&quot;mem1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ram_size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
            <span class="s2">&quot;serial&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;numa_node&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d3:00.0&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;decoders:endpoint6&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder6.0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
                <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">549755813888</span><span class="p">,</span>
                <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
                <span class="s2">&quot;interleave_granularity&quot;</span><span class="p">:</span><span class="mi">256</span><span class="p">,</span>
                <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="s2">&quot;region0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dpa_resource&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;dpa_size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
                <span class="s2">&quot;mode&quot;</span><span class="p">:</span><span class="s2">&quot;ram&quot;</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">],</span>
</pre></div>
</div>
<p>This chunk shows the endpoints attached to the host bridge <code class="code docutils literal notranslate"><span class="pre">port1</span></code>.</p>
<p><code class="code docutils literal notranslate"><span class="pre">endpoint5</span></code> contains a single configured decoder <code class="code docutils literal notranslate"><span class="pre">decoder5.0</span></code>
which has the same interleave configuration as <code class="code docutils literal notranslate"><span class="pre">region0</span></code> (shown later).</p>
<p><code class="code docutils literal notranslate"><span class="pre">endpoint6</span></code> contains a single configured decoder <code class="code docutils literal notranslate"><span class="pre">decoder5.0</span></code>
which has the same interleave configuration as <code class="code docutils literal notranslate"><span class="pre">region0</span></code> (shown later).</p>
<p>Next we have the decoders belonging to the host bridge:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="s2">&quot;decoders:port1&quot;</span><span class="p">:[</span>
        <span class="p">{</span>
            <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder1.0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
            <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">549755813888</span><span class="p">,</span>
            <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;interleave_granularity&quot;</span><span class="p">:</span><span class="mi">512</span><span class="p">,</span>
            <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="s2">&quot;region0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nr_targets&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;targets&quot;</span><span class="p">:[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;target&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:02&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;target&quot;</span><span class="p">:</span><span class="s2">&quot;0000:d2:01.3&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:05&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">},</span>
</pre></div>
</div>
<p>Host Bridge <code class="code docutils literal notranslate"><span class="pre">port1</span></code> has a single decoder (<code class="code docutils literal notranslate"><span class="pre">decoder1.0</span></code>), whose
targets are <code class="code docutils literal notranslate"><span class="pre">dport0</span></code> and <code class="code docutils literal notranslate"><span class="pre">dport2</span></code> - which are attached to
<code class="code docutils literal notranslate"><span class="pre">endpoint5</span></code> and <code class="code docutils literal notranslate"><span class="pre">endpoint6</span></code> respectively.</p>
<p>The following chunk shows a similar configuration for Host Bridge <code class="code docutils literal notranslate"><span class="pre">port3</span></code>,
the second host bridge with a memory device attached.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;port&quot;</span><span class="p">:</span><span class="s2">&quot;port3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:a8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
        <span class="p">{</span>
            <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:a8:01.1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:c3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:a8:01.3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:c5&quot;</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;endpoints:port3&quot;</span><span class="p">:[</span>
        <span class="p">{</span>
            <span class="s2">&quot;endpoint&quot;</span><span class="p">:</span><span class="s2">&quot;endpoint7&quot;</span><span class="p">,</span>
            <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;mem2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;parent_dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:a8:01.1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;memdev&quot;</span><span class="p">:{</span>
                <span class="s2">&quot;memdev&quot;</span><span class="p">:</span><span class="s2">&quot;mem2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ram_size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
                <span class="s2">&quot;serial&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;numa_node&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;0000:a9:00.0&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;decoders:endpoint7&quot;</span><span class="p">:[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder7.0&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
                    <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">549755813888</span><span class="p">,</span>
                    <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
                    <span class="s2">&quot;interleave_granularity&quot;</span><span class="p">:</span><span class="mi">256</span><span class="p">,</span>
                    <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="s2">&quot;region0&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;dpa_resource&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;dpa_size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
                    <span class="s2">&quot;mode&quot;</span><span class="p">:</span><span class="s2">&quot;ram&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;endpoint&quot;</span><span class="p">:</span><span class="s2">&quot;endpoint8&quot;</span><span class="p">,</span>
            <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;mem3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;parent_dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:a8:01.3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;memdev&quot;</span><span class="p">:{</span>
                <span class="s2">&quot;memdev&quot;</span><span class="p">:</span><span class="s2">&quot;mem3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ram_size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
                <span class="s2">&quot;serial&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;numa_node&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;0000:a9:00.0&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;decoders:endpoint8&quot;</span><span class="p">:[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder8.0&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
                    <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">549755813888</span><span class="p">,</span>
                    <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
                    <span class="s2">&quot;interleave_granularity&quot;</span><span class="p">:</span><span class="mi">256</span><span class="p">,</span>
                    <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="s2">&quot;region0&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;dpa_resource&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;dpa_size&quot;</span><span class="p">:</span><span class="mi">137438953472</span><span class="p">,</span>
                    <span class="s2">&quot;mode&quot;</span><span class="p">:</span><span class="s2">&quot;ram&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;decoders:port3&quot;</span><span class="p">:[</span>
        <span class="p">{</span>
            <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder3.0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
            <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">549755813888</span><span class="p">,</span>
            <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;interleave_granularity&quot;</span><span class="p">:</span><span class="mi">512</span><span class="p">,</span>
            <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="s2">&quot;region0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nr_targets&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;targets&quot;</span><span class="p">:[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;target&quot;</span><span class="p">:</span><span class="s2">&quot;0000:a8:01.1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:c3&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;target&quot;</span><span class="p">:</span><span class="s2">&quot;0000:a8:01.3&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:c5&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">},</span>
</pre></div>
</div>
<p>The next chunk shows the two CXL host bridges without attached endpoints.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="p">:</span><span class="s2">&quot;port2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:00:01.3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:55&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">2</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:00:07.1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:5d&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">113</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="p">:</span><span class="s2">&quot;port4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:2a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;depth&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;nr_dports&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;dports&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;dport&quot;</span><span class="p">:</span><span class="s2">&quot;0000:2a:01.1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;device:d0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">],</span>
</pre></div>
</div>
<p>Next we have the <cite>Root Decoders</cite> belonging to <code class="code docutils literal notranslate"><span class="pre">root0</span></code>.  This root decoder
applies the interleave across the downstream ports <code class="code docutils literal notranslate"><span class="pre">port1</span></code> and
<code class="code docutils literal notranslate"><span class="pre">port3</span></code> - with a granularity of 256 bytes.</p>
<p>This information is generated by the CXL driver reading the ACPI CEDT CMFWS.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;decoders:root0&quot;</span><span class="p">:[</span>
    <span class="p">{</span>
        <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder0.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
        <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">549755813888</span><span class="p">,</span>
        <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;interleave_granularity&quot;</span><span class="p">:</span><span class="mi">256</span><span class="p">,</span>
        <span class="s2">&quot;max_available_extent&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;volatile_capable&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">,</span>
        <span class="s2">&quot;nr_targets&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;targets&quot;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s2">&quot;target&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:a8&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:02&quot;</span><span class="p">,</span>
                <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">4</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;target&quot;</span><span class="p">:</span><span class="s2">&quot;pci0000:d2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alias&quot;</span><span class="p">:</span><span class="s2">&quot;ACPI0016:00&quot;</span><span class="p">,</span>
                <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">5</span>
            <span class="p">}</span>
        <span class="p">],</span>
</pre></div>
</div>
<p>Finally we have the <cite>Memory Region</cite> associated with the <cite>Root Decoder</cite>
<code class="code docutils literal notranslate"><span class="pre">decoder0.0</span></code>.  This region describes the overall interleave configuration
of the interleave set.  So we see there are a total of <code class="code docutils literal notranslate"><span class="pre">4</span></code> interleave
targets across 4 endpoint decoders.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>              <span class="s2">&quot;regions:decoder0.0&quot;</span><span class="p">:[</span>
                  <span class="p">{</span>
                      <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="s2">&quot;region0&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;resource&quot;</span><span class="p">:</span><span class="mi">825975898112</span><span class="p">,</span>
                      <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">549755813888</span><span class="p">,</span>
                      <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;ram&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;interleave_ways&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
                      <span class="s2">&quot;interleave_granularity&quot;</span><span class="p">:</span><span class="mi">256</span><span class="p">,</span>
                      <span class="s2">&quot;decode_state&quot;</span><span class="p">:</span><span class="s2">&quot;commit&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;mappings&quot;</span><span class="p">:[</span>
                          <span class="p">{</span>
                              <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                              <span class="s2">&quot;memdev&quot;</span><span class="p">:</span><span class="s2">&quot;mem3&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder8.0&quot;</span>
                          <span class="p">},</span>
                          <span class="p">{</span>
                              <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                              <span class="s2">&quot;memdev&quot;</span><span class="p">:</span><span class="s2">&quot;mem1&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder6.0&quot;</span>
                          <span class="p">}</span>
                          <span class="p">{</span>
                              <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                              <span class="s2">&quot;memdev&quot;</span><span class="p">:</span><span class="s2">&quot;mem2&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder7.0&quot;</span>
                          <span class="p">},</span>
                          <span class="p">{</span>
                              <span class="s2">&quot;position&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                              <span class="s2">&quot;memdev&quot;</span><span class="p">:</span><span class="s2">&quot;mem0&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;decoder&quot;</span><span class="p">:</span><span class="s2">&quot;decoder5.0&quot;</span>
                          <span class="p">}</span>
                      <span class="p">]</span>
                  <span class="p">}</span>
              <span class="p">]</span>
          <span class="p">}</span>
      <span class="p">]</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
</div>
</section>
</section>
<span id="document-linux/dax-driver"></span><section id="dax-driver-operation">
<h2>DAX Driver Operation<a class="headerlink" href="#dax-driver-operation" title="Link to this heading"></a></h2>
<p>The <cite>Direct Access Device</cite> driver was originally designed to provide a
memory-like access mechanism to memory-like block-devices.  It was
extended to support CXL Memory Devices, which provide user-configured
memory devices.</p>
<p>The CXL subsystem depends on the DAX subsystem to generate either:</p>
<ul class="simple">
<li><p>A file-like interface to userland via <code class="code docutils literal notranslate"><span class="pre">/dev/daxN.Y</span></code>, or</p></li>
<li><p>Engaging the memory-hotplug interface to add CXL memory to page allocator.</p></li>
</ul>
<p>The DAX subsystem exposes this ability through the <cite>cxl_dax_region</cite> driver.
A <cite>dax_region</cite> provides the translation between a CXL <cite>memory_region</cite> and
a <cite>DAX Device</cite>.</p>
<section id="dax-device">
<h3>DAX Device<a class="headerlink" href="#dax-device" title="Link to this heading"></a></h3>
<p>A <cite>DAX Device</cite> is a file-like interface exposed in <code class="code docutils literal notranslate"><span class="pre">/dev/daxN.Y</span></code>. A
memory region exposed via dax device can be accessed via userland software
via the <code class="code docutils literal notranslate"><span class="pre">mmap()</span></code> system-call.  The result is direct mappings to the
CXL capacity in the task’s page tables.</p>
<p>Users wishing to manually handle allocation of CXL memory should use this
interface.</p>
</section>
<section id="kmem-conversion">
<h3>kmem conversion<a class="headerlink" href="#kmem-conversion" title="Link to this heading"></a></h3>
<p>The <code class="code docutils literal notranslate"><span class="pre">dax_kmem</span></code> driver converts a <cite>DAX Device</cite> into a series of <cite>hotplug
memory blocks</cite> managed by <code class="code docutils literal notranslate"><span class="pre">kernel/memory-hotplug.c</span></code>.  This capacity
will be exposed to the kernel page allocator in the user-selected memory
zone.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">memmap_on_memory</span></code> setting (both global and DAX device local) dictate
where the kernell will allocate the <code class="code docutils literal notranslate"><span class="pre">struct</span> <span class="pre">folio</span></code> descriptors for this
memory will come from.  If <code class="code docutils literal notranslate"><span class="pre">memmap_on_memory</span></code> is set, memory hotplug
will set aside a portion of the memory block capacity to allocate folios.  If
unset, the memory is allocated via a normal <code class="code docutils literal notranslate"><span class="pre">GFP_KERNEL</span></code> allocation -
and as a result will most likely land on the local NUM node of the cpu executing
the hotplug operation.</p>
</section>
</section>
<span id="document-linux/memory-hotplug"></span><section id="memory-hotplug">
<h2>Memory Hotplug<a class="headerlink" href="#memory-hotplug" title="Link to this heading"></a></h2>
<p>The final phase of surfacing CXL memory to the kernel page allocator is for
the <cite>DAX</cite> driver to surface a <cite>Driver Managed</cite> memory region via the
memory-hotplug component.</p>
<p>There are four major configurations to consider</p>
<ol class="arabic simple">
<li><p>Default Online Behavior (on/off and zone)</p></li>
<li><p>Hotplug Memory Block size</p></li>
<li><p>Memory Map Resource location</p></li>
<li><p>Driver-Managed Memory Designation</p></li>
</ol>
<section id="default-online-behavior">
<h3>Default Online Behavior<a class="headerlink" href="#default-online-behavior" title="Link to this heading"></a></h3>
<p>The default-online behavior of hotplug memory is dictated by the following,
in order of precedence:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">CONFIG_MHP_DEFAULT_ONLINE_TYPE</span></code> Build Configuration</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">memhp_default_state</span></code> Boot parameters</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">/sys/devices/system/memory/auto_online_blocks</span></code> value</p></li>
</ul>
<p>These dictate whether hotplugged memory blocks arrive in one of three states:</p>
<ol class="arabic simple">
<li><p>Offline</p></li>
<li><p>Online in <code class="code docutils literal notranslate"><span class="pre">ZONE_NORMAL</span></code></p></li>
<li><p>Online in <code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code></p></li>
</ol>
<p><code class="code docutils literal notranslate"><span class="pre">ZONE_NORMAL</span></code> implies this capacity may be used for almost any allocation,
while <code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code> implies this capacity should only be used for
migratable allocations.</p>
<p><code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code> attempts to retain the hotplug-ability of a memory block
so that it the entire region may be hot-unplugged at a later time.  Any capacity
onlined into <code class="code docutils literal notranslate"><span class="pre">ZONE_NORMAL</span></code> should be considered permanently attached to
the page allocator.</p>
</section>
<section id="hotplug-memory-block-size">
<h3>Hotplug Memory Block Size<a class="headerlink" href="#hotplug-memory-block-size" title="Link to this heading"></a></h3>
<p>By default, on most architectures, the Hotplug Memory Block Size is either
128MB or 256MB.  On x86, the block size increases up to 2GB as total memory
capacity exceeds 64GB.  As of v6.15, Linux does not take into account the
size and alignment of the ACPI CEDT CFMWS regions (see Early Boot docs) when
deciding the Hotplug Memory Block Size.</p>
</section>
<section id="memory-map">
<h3>Memory Map<a class="headerlink" href="#memory-map" title="Link to this heading"></a></h3>
<p>The location of <code class="code docutils literal notranslate"><span class="pre">struct</span> <span class="pre">folio</span></code> allocations to represent the hotplugged
memory capacity are dicated by the following system settings:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">/sys_module/memory_hotplug/parameters/memmap_on_memory</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">/sys/bus/dax/devices/daxN.Y/memmap_on_memory</span></code></p></li>
</ul>
<p>If both of these parameters are set to true, <code class="code docutils literal notranslate"><span class="pre">struct</span> <span class="pre">folio</span></code> for this
capacity will be carved out of the memory block being onlined.  This has
performance implications if the memory is particularly high-latency and
its <code class="code docutils literal notranslate"><span class="pre">struct</span> <span class="pre">folio</span></code> becomes hotly contended.</p>
<p>If either parameter is set to false, <code class="code docutils literal notranslate"><span class="pre">struct</span> <span class="pre">folio</span></code> for this capacity
will be allocated from the local node of the processor running the hotplug
procedure.  This capacity will be allocated from <code class="code docutils literal notranslate"><span class="pre">ZONE_NORMAL</span></code> on
that node, as it is a <code class="code docutils literal notranslate"><span class="pre">GFP_KERNEL</span></code> allocation.</p>
<p>Systems with extremely large amounts of <code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code> memory (e.g.
CXL memory pools) must ensure that there is sufficient local
<code class="code docutils literal notranslate"><span class="pre">ZONE_NORMAL</span></code> capacity to host the memory map for the hotplugged capacity.</p>
</section>
<section id="driver-managed-memory">
<h3>Driver Managed Memory<a class="headerlink" href="#driver-managed-memory" title="Link to this heading"></a></h3>
<p>The DAX driver surfaces this memory to memory-hotplug as “Driver Managed”. This
is not a configurable setting, but it’s important to not that driver managed
memory is explicitly excluded from use during kexec.  This is required to ensure
any reset or out-of-band operations that the CXL device may be subject to during
a functional system-reboot (such as a reset-on-probe) will not cause portions of
the kexec kernel to be overwritten.</p>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-allocation/dax"></span><section id="dax-devices">
<h2>DAX Devices<a class="headerlink" href="#dax-devices" title="Link to this heading"></a></h2>
<p>CXL capacity exposed as a DAX device can be accessed directly via mmap.
Users may wish to use this interface mechanism to write their own userland
CXL allocator, or to managed shared or persistent memory regions across multiple
hosts.</p>
<p>If the capacity is shared across hosts or persistent, appropriate flushing
mechanisms must be employed unless the region supports Snoop Back-Invalidate.</p>
<p>Note that mappings must be aligned (size and base) to the dax device’s base
alignment, which is typically 2MB - but maybe be configured larger.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>
<span class="c1">#include &lt;stdint.h&gt;</span>
<span class="c1">#include &lt;sys/mman.h&gt;</span>
<span class="c1">#include &lt;fcntl.h&gt;</span>
<span class="c1">#include &lt;unistd.h&gt;</span>

<span class="c1">#define DEVICE_PATH &quot;/dev/dax0.0&quot; // Replace DAX device path</span>
<span class="c1">#define DEVICE_SIZE (4ULL * 1024 * 1024 * 1024) // 4GB</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">int</span> <span class="n">fd</span><span class="p">;</span>
    <span class="n">void</span><span class="o">*</span> <span class="n">mapped_addr</span><span class="p">;</span>

    <span class="o">/*</span> <span class="n">Open</span> <span class="n">the</span> <span class="n">DAX</span> <span class="n">device</span> <span class="o">*/</span>
    <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">DEVICE_PATH</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fd</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">/*</span> <span class="n">Map</span> <span class="n">the</span> <span class="n">device</span> <span class="n">into</span> <span class="n">memory</span> <span class="o">*/</span>
    <span class="n">mapped_addr</span> <span class="o">=</span> <span class="n">mmap</span><span class="p">(</span><span class="n">NULL</span><span class="p">,</span> <span class="n">DEVICE_SIZE</span><span class="p">,</span> <span class="n">PROT_READ</span> <span class="o">|</span> <span class="n">PROT_WRITE</span><span class="p">,</span>
                       <span class="n">MAP_SHARED</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mapped_addr</span> <span class="o">==</span> <span class="n">MAP_FAILED</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s2">&quot;mmap&quot;</span><span class="p">);</span>
        <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Mapped address: %p</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mapped_addr</span><span class="p">);</span>

    <span class="o">/*</span> <span class="n">You</span> <span class="n">can</span> <span class="n">now</span> <span class="n">access</span> <span class="n">the</span> <span class="n">device</span> <span class="n">through</span> <span class="n">the</span> <span class="n">mapped</span> <span class="n">address</span> <span class="o">*/</span>
    <span class="n">uint64_t</span><span class="o">*</span> <span class="n">ptr</span> <span class="o">=</span> <span class="p">(</span><span class="n">uint64_t</span><span class="o">*</span><span class="p">)</span><span class="n">mapped_addr</span><span class="p">;</span>
    <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="mh">0x1234567890abcdef</span><span class="p">;</span> <span class="o">//</span> <span class="n">Write</span> <span class="n">a</span> <span class="n">value</span> <span class="n">to</span> <span class="n">the</span> <span class="n">device</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Value at address %p: 0x%016llx</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ptr</span><span class="p">,</span> <span class="o">*</span><span class="n">ptr</span><span class="p">);</span>

    <span class="o">/*</span> <span class="n">Clean</span> <span class="n">up</span> <span class="o">*/</span>
    <span class="n">munmap</span><span class="p">(</span><span class="n">mapped_addr</span><span class="p">,</span> <span class="n">DEVICE_SIZE</span><span class="p">);</span>
    <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<span id="document-allocation/page-allocator"></span><section id="the-page-allocator">
<h2>The Page Allocator<a class="headerlink" href="#the-page-allocator" title="Link to this heading"></a></h2>
<p>The kernel page allocator services all general page allocation requests, such
as <code class="code docutils literal notranslate"><span class="pre">kmalloc</span></code>.  CXL configuration steps affect the behavior of the page
allocator based on the selected <cite>Memory Zone</cite> and <cite>NUMA node</cite> the capacity is
placed in.</p>
<p>This section mostly focuses on how these configurations affect the page
allocator (as of Linux v6.15) rather than the overall page allocator behavior.</p>
<section id="numa-nodes-and-mempolicy">
<h3>NUMA nodes and mempolicy<a class="headerlink" href="#numa-nodes-and-mempolicy" title="Link to this heading"></a></h3>
<p>Unless a task explicitly registers a mempolicy, the default memory policy
of the linux kernel is to allocate memory from the <cite>local NUMA node</cite> first,
and fall back to other nodes only if the local node is pressured.</p>
<p>Generally, we expect to see local DRAM and CXL memory on separate NUMA nodes,
with the CXL memory being non-local.  Technically, however, it is possible
for a compute node to have no local DRAM, and for CXL memory to be the
<cite>local</cite> capacity for that compute node.</p>
</section>
<section id="memory-zones">
<h3>Memory Zones<a class="headerlink" href="#memory-zones" title="Link to this heading"></a></h3>
<p>CXL capacity may be onlined in <code class="code docutils literal notranslate"><span class="pre">ZONE_NORMAL</span></code> or <code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code>.</p>
<p>As of v6.15, the page allocator attempts to allocate from the highest
available and compatible ZONE for an allocation from the local node first.</p>
<p>An example of a <cite>zone incompatibility</cite> is attempting to service an allocation
marked <code class="code docutils literal notranslate"><span class="pre">GFP_KERNEL</span></code> from <code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code>.  Kernel allocations are
typically not migratable, and as a result can only be serviced from
<code class="code docutils literal notranslate"><span class="pre">ZONE_NORMAL</span></code> or lower.</p>
<p>To simplify this, the page allocator will prefer <code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code> over
<code class="code docutils literal notranslate"><span class="pre">ZONE_NORMAL</span></code> by default, but if <code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code> is depleted, it
will fallback to allocate from <code class="code docutils literal notranslate"><span class="pre">ZONE_NORMAL</span></code>.</p>
</section>
<section id="zone-and-node-quirks">
<h3>Zone and Node Quirks<a class="headerlink" href="#zone-and-node-quirks" title="Link to this heading"></a></h3>
<p>Lets consider a configuration where the local DRAM capacity is largely onlined
into <code class="code docutils literal notranslate"><span class="pre">ZONE_NORMAL</span></code>, with no <code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code> capacity present. The
CXL capacity has the opposite configuration - all onlined in
<code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code>.</p>
<p>Under the default allocation policy, the page allocator will completely skip
<code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code> has a valid allocation target.  This is because, as of
Linux v6.15, the page allocator does approximately the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">each</span> <span class="n">zone</span> <span class="ow">in</span> <span class="n">local_node</span><span class="p">):</span>

  <span class="k">for</span> <span class="p">(</span><span class="n">each</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">fallback_order</span><span class="p">):</span>

    <span class="n">attempt_allocation</span><span class="p">(</span><span class="n">gfp_flags</span><span class="p">);</span>
</pre></div>
</div>
<p>Because the local node does not have <code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code>, the CXL node is
functionally unreachable for direct allocation.  As a result, the only way
for CXL capacity to be used is via <cite>demotion</cite> in the reclaim path.</p>
<p>This configuration also means that if the DRAM ndoe has <code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code>
capacity - when that capacity is depleted, the page allocator will actually
prefer CXL <code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code> pages over DRAM <code class="code docutils literal notranslate"><span class="pre">ZONE_NORMAL</span></code> pages.</p>
<p>We may wish to invert these configurations in future Linux versions.</p>
<p>If <cite>demotion</cite> and <cite>swap</cite> are disabled, Linux will begin to cause OOM crashes
when the DRAM nodes are depleted. This will be covered amore in depth in the
reclaim section.</p>
</section>
<section id="cgroups-and-cpusets">
<h3>CGroups and CPUSets<a class="headerlink" href="#cgroups-and-cpusets" title="Link to this heading"></a></h3>
<p>Finally, assuming CXL memory is reachable via the page allocation (i.e. onlined
in <code class="code docutils literal notranslate"><span class="pre">ZONE_NORMAL</span></code>), the <code class="code docutils literal notranslate"><span class="pre">cpusets.mems_allowed</span></code> may be used by
containers to limit the accessibility of certain NUMA nodes for tasks in that
container.  Users may wish to utilize this in multi-tenant systems where some
tasks prefer not to use slower memory.</p>
<p>In the reclaim section we’ll discuss some limitations of this interface to
prevent demotions of shared data to CXL memory (if demotions are enabled).</p>
</section>
</section>
<span id="document-allocation/reclaim"></span><section id="reclaim">
<h2>Reclaim<a class="headerlink" href="#reclaim" title="Link to this heading"></a></h2>
<p>Another way CXL memory can be utilized <em>indirectly</em> is via the reclaim system
in <code class="code docutils literal notranslate"><span class="pre">mm/vmscan.c</span></code>.  Reclaim is engaged when memory capacity on the system
becomes pressured based on global and cgroup-local <cite>watermark</cite> settings.</p>
<p>In this section we won’t discuss the <cite>watermark</cite> configurations, just how CXL
memory can be consumed by various pieces of reclaim system.</p>
<section id="demotion">
<h3>Demotion<a class="headerlink" href="#demotion" title="Link to this heading"></a></h3>
<p>By default, the reclaim system will prefer swap (or zswap) when reclaiming
memory.  Enabling <code class="code docutils literal notranslate"><span class="pre">kernel/mm/numa/demotion_enabled</span></code> will cause vmscan
to opportunistically prefer distant NUMA nodes to swap or zswap, if capacity
is available.</p>
<p>Demotion engages the <code class="code docutils literal notranslate"><span class="pre">mm/memory_tier.c</span></code> component to determine the
next demotion node.  The next demotion node is based on the <code class="code docutils literal notranslate"><span class="pre">HMAT</span></code>
or <code class="code docutils literal notranslate"><span class="pre">CDAT</span></code> performance data.</p>
<section id="cpusets-mems-allowed-quirk">
<h4>cpusets.mems_allowed quirk<a class="headerlink" href="#cpusets-mems-allowed-quirk" title="Link to this heading"></a></h4>
<p>In Linux v6.15 and below, demotion does not respect <code class="code docutils literal notranslate"><span class="pre">cpusets.mems_allowed</span></code>
when migrating pages.  As a result, if demotion is enabled, vmscan cannot
guarantee isolation of a container’s memory from nodes not set in mems_allowed.</p>
<p>In Linux v6.XX and up, demotion does attempt to respect
<code class="code docutils literal notranslate"><span class="pre">cpusets.mems_allowed</span></code>; however, certain classes of shared memory
originally instantiated by another cgroup (such as common libraries - e.g.
libc) may still be demoted.  As a result, the mems_allowed interface still
cannot provide perfect isolation from the remote nodes.</p>
</section>
</section>
<section id="zswap-and-node-preference">
<h3>ZSwap and Node Preference<a class="headerlink" href="#zswap-and-node-preference" title="Link to this heading"></a></h3>
<p>In Linux v6.15 and below, ZSwap allocates memory from the local node of the
processor for the new pages being compressed.  Since pages being compressed
are typically cold, the result is a cold page becomes promoted - only to
be later demoted as it ages off the LRU.</p>
<p>In Linux v6.XX, ZSwap tries to prefer the node of the page being compressed
as the allocation target for the compression page.  This helps prevernt
thrashing.</p>
</section>
<section id="demotion-with-zswap">
<h3>Demotion with ZSwap<a class="headerlink" href="#demotion-with-zswap" title="Link to this heading"></a></h3>
<p>When enabling both Demotion and ZSwap, you create a situation where ZSwap
will prefer the slowest form of CXL memory by default until that tier of
memory is exausted.</p>
</section>
</section>
<span id="document-allocation/hugepages"></span><section id="huge-pages">
<h2>Huge Pages<a class="headerlink" href="#huge-pages" title="Link to this heading"></a></h2>
<section id="contiguous-memory-allocator">
<h3>Contiguous Memory Allocator<a class="headerlink" href="#contiguous-memory-allocator" title="Link to this heading"></a></h3>
<p>CXL Memory onlined as SystemRAM during early boot is eligible for use by CMA,
as the NUMA node hosting that capacity will be <cite>Online</cite> at the time CMA
carves out contiguous capacity.</p>
<p>CXL Memory deferred to the CXL Driver for configuration cannot have its
capacity allocated by CMA - as the NUMA node hosting the capacity is <cite>Offline</cite>
at <code class="code docutils literal notranslate"><span class="pre">__init</span></code> time - which CMA carves out contiguous capacity.</p>
</section>
<section id="hugetlb">
<h3>HugeTLB<a class="headerlink" href="#hugetlb" title="Link to this heading"></a></h3>
<section id="mb-huge-pages">
<h4>2MB Huge Pages<a class="headerlink" href="#mb-huge-pages" title="Link to this heading"></a></h4>
<p>All CXL capacity regardless of configuration time or memory zone is eligible
for use as 2MB huge pages.</p>
</section>
<section id="gb-huge-pages">
<h4>1GB Huge Pages<a class="headerlink" href="#gb-huge-pages" title="Link to this heading"></a></h4>
<p>CXL capacity onlined in <code class="code docutils literal notranslate"><span class="pre">ZONE_NORMAL</span></code> is eligible for 1GB Gigantic Page
allocation.</p>
<p>CXL capacity onlined in <code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code> is not eligible for 1GB Gigantic
Page allocation.</p>
</section>
</section>
</section>
<span id="document-allocation/tiering"></span><section id="memory-tiering">
<h2>Memory Tiering<a class="headerlink" href="#memory-tiering" title="Link to this heading"></a></h2>
<p>todo</p>
<section id="memory-tiers">
<h3>Memory Tiers<a class="headerlink" href="#memory-tiers" title="Link to this heading"></a></h3>
<p>todo</p>
</section>
<section id="transparent-page-placement">
<h3>Transparent Page Placement<a class="headerlink" href="#transparent-page-placement" title="Link to this heading"></a></h3>
<p>todo</p>
</section>
<section id="data-access-monitor">
<h3>Data Access MONitor<a class="headerlink" href="#data-access-monitor" title="Link to this heading"></a></h3>
<p>to be updated</p>
<section id="references">
<h4>References<a class="headerlink" href="#references" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://lore.kernel.org/all/20250320053937.57734-1-sj&#64;kernel.org/">Self-tuned Memory Tiering RFC prototype and its evaluation</a></p></li>
<li><p><a class="reference external" href="https://github.com/skhynix/hmsdk/wiki/Capacity-Expansion">SK Hynix HMSDK Capacity Expansion</a></p></li>
<li><p><a class="reference external" href="https://origin.kernel.org/doc/html/latest/mm/damon/">kernel documentation</a></p></li>
<li><p><a class="reference external" href="https://damonitor.github.io/">project website</a></p></li>
</ul>
</section>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-use-case/memory-expansion"></span><section id="memory-expansion">
<h2>Memory Expansion<a class="headerlink" href="#memory-expansion" title="Link to this heading"></a></h2>
<p>todo</p>
<section id="as-page-cache">
<h3>As Page Cache<a class="headerlink" href="#as-page-cache" title="Link to this heading"></a></h3>
<p>todo</p>
</section>
<section id="as-dax-device">
<h3>As DAX Device<a class="headerlink" href="#as-dax-device" title="Link to this heading"></a></h3>
<p>todo</p>
</section>
</section>
<span id="document-use-case/dynamic-capacity"></span><section id="dynamic-capacity">
<h2>Dynamic Capacity<a class="headerlink" href="#dynamic-capacity" title="Link to this heading"></a></h2>
<p>todo</p>
<section id="for-virtual-machines">
<h3>For Virtual Machines<a class="headerlink" href="#for-virtual-machines" title="Link to this heading"></a></h3>
<p>todo</p>
</section>
<section id="for-workload-orchestration">
<h3>For Workload Orchestration<a class="headerlink" href="#for-workload-orchestration" title="Link to this heading"></a></h3>
<p>todo</p>
</section>
<section id="for-shared-memory">
<h3>For Shared Memory<a class="headerlink" href="#for-shared-memory" title="Link to this heading"></a></h3>
<p>todo</p>
</section>
</section>
<span id="document-use-case/virtual-machines"></span><section id="virtual-machines">
<h2>Virtual Machines<a class="headerlink" href="#virtual-machines" title="Link to this heading"></a></h2>
<p>todo</p>
<section id="numa-passthrough">
<h3>NUMA Passthrough<a class="headerlink" href="#numa-passthrough" title="Link to this heading"></a></h3>
<p>todo</p>
</section>
<section id="flexible-shapes">
<h3>Flexible Shapes<a class="headerlink" href="#flexible-shapes" title="Link to this heading"></a></h3>
<p>todo</p>
</section>
<section id="datacenter-efficiency">
<h3>Datacenter Efficiency<a class="headerlink" href="#datacenter-efficiency" title="Link to this heading"></a></h3>
<p>todo</p>
</section>
</section>
<span id="document-use-case/shared-memory"></span><section id="shared-memory">
<h2>Shared Memory<a class="headerlink" href="#shared-memory" title="Link to this heading"></a></h2>
<p>todo</p>
<section id="coherence">
<h3>Coherence<a class="headerlink" href="#coherence" title="Link to this heading"></a></h3>
<p>todo</p>
</section>
<section id="fabric-attached-memory-filesystem-famfs">
<h3>Fabric Attached Memory FileSystem (FAMFS)<a class="headerlink" href="#fabric-attached-memory-filesystem-famfs" title="Link to this heading"></a></h3>
<p>todo</p>
</section>
</section>
</div>
</section>
<section id="contributors">
<h1>Contributors<a class="headerlink" href="#contributors" title="Link to this heading"></a></h1>
<ul class="simple">
<li><p>Gregory Price</p></li>
<li><p>Joshua Hahn</p></li>
</ul>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Gregory Price.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>